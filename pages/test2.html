<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://vega.github.io/vega/assets/main.css">
    <script src="https://vega.github.io/vega/vega.js"></script>
</head>
<body>
<div class="example">
    <div class="embed">
        <div id="stacked-bar-chart" class="view"></div>
    </div>
    <script>
        var spec =
        {
            "$schema": "https://vega.github.io/schema/vega/v3.0.json",
            "width": 1,
            "height": 1,
            "padding": "auto",
            "data": [
                {
                    "name": "source",
                    "values": [
                        {"name": "Moyenne","vote": "white","nbr": 20},
                        {"name": "Moyenne","vote": "yes","nbr": 40},
                        {"name": "Moyenne","vote": "no","nbr": 40},
                        {"name": "nameX","vote": "white","nbr": 10},
                        {"name": "nameX","vote": "yes","nbr": 35},
                        {"name": "nameX","vote": "no","nbr": 55},
                        {"name": "nameY","vote": "white","nbr": 15},
                        {"name": "nameY","vote": "yes","nbr": 70},
                        {"name": "nameY","vote": "no","nbr": 15},
                        {"name": "nameZ","vote": "white","nbr": 0},
                        {"name": "nameZ","vote": "yes","nbr": 50},
                        {"name": "nameZ","vote": "no","nbr": 50},
                        {"name": "nameA","vote": "white","nbr": 5},
                        {"name": "nameA","vote": "yes","nbr": 25},
                        {"name": "nameA","vote": "no","nbr": 70},
                        {"name": "nameB","vote": "white","nbr": 8},
                        {"name": "nameB","vote": "yes","nbr": 22},
                        {"name": "nameB","vote": "no","nbr": 70},
                        {"name": "nameC","vote": "white","nbr": 15},
                        {"name": "nameC","vote": "yes","nbr": 70},
                        {"name": "nameC","vote": "no","nbr": 15},
                        {"name": "nameD","vote": "white","nbr": 0},
                        {"name": "nameD","vote": "yes","nbr": 50},
                        {"name": "nameD","vote": "no","nbr": 50},
                        {"name": "nameE","vote": "white","nbr": 5},
                        {"name": "nameE","vote": "yes","nbr": 25},
                        {"name": "nameE","vote": "no","nbr": 70},
                        {"name": "nameF","vote": "white","nbr": 8},
                        {"name": "nameF","vote": "yes","nbr": 22},
                        {"name": "nameF","vote": "no","nbr": 70}
                    ]
                },
                {
                    "name": "summary",
                    "source": "source",
                    "transform": [
                        {
                            "type": "aggregate",
                            "groupby": ["name","vote"],
                            "summarize": {"nbr": ["sum"]}
                        }
                    ]
                },
                {
                    "name": "stacked_scale",
                    "source": "summary",
                    "transform": [
                        {
                            "type": "aggregate",
                            "summarize": [{"ops": ["sum"],"field": "sum_nbr"}],
                            "groupby": ["name"]
                        }
                    ]
                },
                {
                    "name": "layout",
                    "source": "summary",
                    "transform": [
                        {
                            "type": "aggregate",
                            "summarize": [{"field": "name","ops": ["distinct"]}]
                        }
                    ]
                }
            ],
            "marks": [
                {
                    "name": "root",
                    "type": "group",
                    "from": {"data": "layout"},
                    "properties": {
                        "update": {
                            "width": {"field": "width"},
                            "height": {"field": "height"}
                        }
                    },
                    "marks": [
                        {
                            "name": "marks",
                            "type": "rect",
                            "from": {
                                "data": "summary",
                                "transform": [
                                    {
                                        "type": "stack",
                                        "groupby": ["name"],
                                        "field": "sum_nbr",
                                        "sortby": ["-vote"],
                                        "output": {
                                            "start": "sum_nbr_start",
                                            "end": "sum_nbr_end"
                                        },
                                        "offset": "normalize"
                                    }
                                ]
                            },
                            "properties": {
                                "update": {
                                    "x": {"scale": "x","field": "sum_nbr_start"},
                                    "x2": {"scale": "x","field": "sum_nbr_end"},
                                    "yc": {"scale": "y","field": "name"},
                                    "height": {"value": 50},
                                    "fill": {"scale": "color","field": "vote"},
                                    "stroke": {"scale": "colorStroke","field": "vote"},
                                    "strokeWidth": {"value": 2}
                                }
                            }
                        }
                    ],
                    "scales": [
                        {
                            "name": "x",
                            "type": "linear",
                            "domain": [0,1],
                            "rangeMin": 0,
                            "rangeMax": 500,
                            "round": true,
                            "nice": true,
                            "zero": true
                        },
                        {
                            "name": "y",
                            "type": "ordinal",
                            "domain": {"data": "summary","field": "name","sort": true},
                            "bandSize": 50,
                            "round": true,
                            "points": true,
                            "padding": 1
                        },
                        {
                            "name": "color",
                            "type": "ordinal",
                            "domain": {"data": "summary","field": "vote","sort": true},
                            "range": ["#FF0000","#FFFFFF","#008000"]
                        },
                        {
                            "name": "colorStroke",
                            "type": "ordinal",
                            "domain": {"data": "source","field": "vote"},
                            "range": ["#000000"]
                        }
                    ],
                    "axes": [{"type": "y","scale": "y"}],
                    "legends": [
                        {
                            "fill": "color",
                            "title": "vote",
                            "orient": "left",
                            "properties": {
                                "symbols": {
                                    "shape": {"value": "circle"},
                                    "strokeWidth": {"value": 1}
                                }
                            }
                        }
                    ]
                }
            ]
        };

        var view = new vega.View(vega.parse(spec), {
            loader: vega.loader({baseURL: ''}),
            logLevel: vega.Warn,
            renderer: 'canvas'
        }).initialize('#stacked-bar-chart').hover().run();
    </script>
</div>
</body>
</html>