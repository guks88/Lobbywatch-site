!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("vega-util"),require("vega-loader"),require("d3-shape"),require("d3-path")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-loader","d3-shape","d3-path"],e):e(t.vega=t.vega||{},t.vega,t.vega,t.d3,t.d3)}(this,function(t,e,n,i,r){"use strict";function o(t){this.clear(),t&&this.union(t)}function a(t){this.mark=t,this.bounds=this.bounds||new o,this.bounds_prev=this.bounds_prev||new o}function s(t){a.call(this,t),this.items=this.items||[]}function u(t,e,n){return!t&&"undefined"!=typeof document&&document.createElement&&(t=document),t?n?t.createElementNS(n,e):t.createElement(e):null}function l(t,e){e=e.toLowerCase();for(var n=t.childNodes,i=0,r=n.length;i<r;++i)if(n[i].tagName.toLowerCase()===e)return n[i]}function h(t,e,n,i){var r,o=t.childNodes[e];return o&&o.tagName.toLowerCase()===n.toLowerCase()||(r=o||null,o=u(t.ownerDocument,n,i),t.insertBefore(o,r)),o}function c(t,e){for(var n=t.childNodes,i=n.length;i>e;)t.removeChild(n[--i]);return t}function f(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function d(t){this._pending=0,this._loader=t||n.loader()}function v(t){t._pending+=1}function g(t){t._pending-=1}function p(t,e,n){var i=Se.hasOwnProperty(t)&&Se[t],r=null;return i&&(r=i.curve||i[e||"vertical"],i.tension&&null!=n&&(r=r[i.tension](n))),r}function y(t,e,n,i,r,o,a,s,u){var l=Ne.call(arguments);if(Re[l])return Re[l];var h=a*(Math.PI/180),c=Math.sin(h),f=Math.cos(h);n=Math.abs(n),i=Math.abs(i);var d=f*(s-t)*.5+c*(u-e)*.5,v=f*(u-e)*.5-c*(s-t)*.5,g=d*d/(n*n)+v*v/(i*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);var p=f/n,y=c/n,_=-c/i,m=f/i,x=p*s+y*u,b=_*s+m*u,k=p*t+y*e,w=_*t+m*e,T=(k-x)*(k-x)+(w-b)*(w-b),M=1/T-.25;M<0&&(M=0);var C=Math.sqrt(M);o==r&&(C=-C);var z=.5*(x+k)-C*(w-b),A=.5*(b+w)+C*(k-x),P=Math.atan2(b-A,x-z),S=Math.atan2(w-A,k-z),q=S-P;q<0&&1===o?q+=2*Math.PI:q>0&&0===o&&(q-=2*Math.PI);for(var L=Math.ceil(Math.abs(q/(.5*Math.PI+.001))),O=[],R=0;R<L;++R){var I=P+R*q/L,N=P+(R+1)*q/L;O[R]=[z,A,I,N,n,i,c,f]}return Re[l]=O}function _(t){var e=Ne.call(t);if(Ie[e])return Ie[e];var n=t[0],i=t[1],r=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],h=l*a,c=-u*s,f=u*a,d=l*s,v=Math.cos(r),g=Math.sin(r),p=Math.cos(o),y=Math.sin(o),_=.5*(o-r),m=Math.sin(.5*_),x=8/3*m*m/Math.sin(_),b=n+v-x*g,k=i+g+x*v,w=n+p,T=i+y,M=w+x*y,C=T-x*p;return Ie[e]=[h*b+c*k,f*b+d*k,h*M+c*C,f*M+d*C,h*w+c*T,f*w+d*T]}function m(t,e){var n=Ee[0]=t[0];if("a"===n||"A"===n)Ee[1]=e*t[1],Ee[2]=e*t[2],Ee[6]=e*t[6],Ee[7]=e*t[7];else for(var i=1,r=t.length;i<r;++i)Ee[i]=e*t[i];return Ee}function x(t,e,n,i){for(var r=y(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,n),o=0;o<r.length;++o){var a=_(r[o]);t.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])}}function b(t){return Ge.hasOwnProperty(t)?Ge[t]:k(t)}function k(t){if(!We.hasOwnProperty(t)){var e=Oe(t);We[t]={draw:function(t,n){De(t,e,0,0,Math.sqrt(n)/2)}}}return We[t]}function w(t){return t.x}function T(t){return t.y}function M(t){return t.width}function C(t){return t.height}function z(t){return function(){return t}}function A(t){return t.x||0}function P(t){return t.y||0}function S(t){return t.width||0}function q(t){return t.size||1}function L(t){return t.height||0}function O(t){return(t.x||0)+(t.width||0)}function R(t){return(t.y||0)+(t.height||0)}function I(t){return t.cornerRadius||0}function N(t){return t.padAngle||0}function E(t){return!(t.defined===!1)}function D(t){return null==t.size?64:t.size}function H(t){return b(t.shape||"circle")}function V(t,e){return Xe.context(t)(e)}function G(t,e){var n=e[0],i=n.interpolate||"linear";return("horizontal"===n.orient?Qe:Je).curve(p(i,n.orient,n.tension)).context(t)(e)}function W(t,e){var n=e[0],i=n.interpolate||"linear";return Ye.curve(p(i,n.orient,n.tension)).context(t)(e)}function B(t,e,n,i){return Ze.context(t)(e,n,i)}function j(t,e){return(e.mark.shape||e.shape).context(t)(e)}function U(t,e){return $e.context(t)(e)}function X(t,e){return Fe.context(t)(e)}function J(t){return Pe=t,J}function Q(){}function Y(t,e){Pe.add(t,e)}function Z(t,e){return t.zindex-e.zindex||t.index-e.index}function $(t){if(!t.zdirty)return t.zitems;var e,n,i,r=t.items,o=[];for(n=0,i=r.length;n<i;++n)e=r[n],e.index=n,e.zindex&&o.push(e);return t.zdirty=!1,t.zitems=o.sort(Z)}function F(t,e){var n,i,r=t.items;if(r&&r.length){var o=$(t);if(o&&o.length){for(n=0,i=r.length;n<i;++n)r[n].zindex||e(r[n]);r=o}for(n=0,i=r.length;n<i;++n)e(r[n])}}function K(t,e){var n,i,r=t.items;if(!r||!r.length)return null;var o=$(t);for(o&&o.length&&(r=o),i=r.length;--i>=0;)if(n=e(r[i]))return n;if(r===o)for(r=t.items,i=r.length;--i>=0;)if(!r[i].zindex&&(n=e(r[i])))return n;return null}function tt(t){return function(e,n,i){F(n,function(n){i&&!i.intersects(n.bounds)||nt(t,e,n,n)})}}function et(t){return function(e,n,i){!n.items.length||i&&!i.intersects(n.bounds)||nt(t,e,n.items[0],n.items)}}function nt(t,e,n,i){var r=null==n.opacity?1:n.opacity;0!==r&&(t(e,i)||(n.fill&&un(e,n,r)&&e.fill(),n.stroke&&hn(e,n,r)&&e.stroke()))}function it(t){return t||(t=cn),function(e,n,i,r,o,a){return e.pixelRatio>1&&(i*=e.pixelRatio,r*=e.pixelRatio),K(n,function(n){var s=n.bounds;if((!s||s.contains(o,a))&&s)return t(e,n,i,r,o,a)?n:void 0})}}function rt(t,e){return function(n,i,r,o){var a,s,u=Array.isArray(i)?i[0]:i,l=null==e?u.fill:e,h=u.stroke&&n.isPointInStroke;return h&&(a=u.strokeWidth,s=u.strokeCap,n.lineWidth=null!=a?a:1,n.lineCap=null!=s?s:"butt"),!t(n,i)&&(l&&n.isPointInPath(r,o)||h&&n.isPointInStroke(r,o))}}function ot(t){return it(rt(t))}function at(t,e){t("transform",dn(e))}function st(t,e){var n=e.stroke?.5:0;t("class","background"),t("d",B(null,e,n,n))}function ut(t,e,n){if(e.clip){var i=n._defs,r=e.clip_id||(e.clip_id="clip"+i.clip_id++),o=i.clipping[r]||(i.clipping[r]={id:r});o.width=e.width||0,o.height=e.height||0}t("clip-path",r?"url(#"+r+")":null)}function lt(t,e){if(!e.clip&&e.items)for(var n=e.items,i=0,r=n.length;i<r;++i)t.union(n[i].bounds);return(e.clip||e.width||e.height)&&Ke(t.add(0,0).add(e.width||0,e.height||0),e),t.translate(e.x||0,e.y||0)}function ht(t,e,n){var i=this;F(e,function(e){var r,o,a=e.x||0,s=e.y||0,u=e.width||0,l=e.height||0;t.save(),t.translate(a,s),(e.stroke||e.fill)&&(o=null==e.opacity?1:e.opacity,o>0&&(t.beginPath(),r=e.stroke?.5:0,B(t,e,r,r),e.fill&&un(t,e,o)&&t.fill(),e.stroke&&hn(t,e,o)&&t.stroke())),e.clip&&(t.beginPath(),t.rect(0,0,u,l),t.clip()),n&&n.translate(-a,-s),F(e,function(e){i.draw(t,e,n)}),n&&n.translate(a,s),t.restore()})}function ct(t,e,n,i,r,o){if(e.bounds&&!e.bounds.contains(r,o)||!e.items)return null;var a=this;return K(e,function(s){var u,l,h,c;if(c=s.bounds,!c||c.contains(r,o))return l=s.x||0,h=s.y||0,t.save(),t.translate(l,h),l=r-l,h=o-h,u=K(s,function(t){return t.interactive!==!1||"group"===t.marktype?a.pick(t,n,i,l,h):null}),t.restore(),u?u:(u=e.interactive!==!1&&(s.fill||s.stroke)&&l>=0&&l<=s.width&&h>=0&&h<=s.height,u?s:null)})}function ft(t,e){var n=t.image;return n&&n.url===t.url||(n={loaded:!1,width:0,height:0},e.loadImage(t.url).then(function(e){t.image=e,t.image.url=t.url})),n}function dt(t,e){return"center"===t?e/2:"right"===t?e:0}function vt(t,e){return"middle"===t?e/2:"bottom"===t?e:0}function gt(t,e,n){var i=ft(e,n),r=e.x||0,o=e.y||0,a=(null!=e.width?e.width:i.width)||0,s=(null!=e.height?e.height:i.height)||0,u=e.aspect===!1?"none":"xMidYMid";r-=dt(e.align,a),o-=vt(e.baseline,s),t("href",i.src||"","http://www.w3.org/1999/xlink","xlink:href"),t("transform",fn(r,o)),t("width",a),t("height",s),t("preserveAspectRatio",u)}function pt(t,e){var n=e.image,i=e.x||0,r=e.y||0,o=(null!=e.width?e.width:n&&n.width)||0,a=(null!=e.height?e.height:n&&n.height)||0;return i-=dt(e.align,o),r-=vt(e.baseline,a),t.set(i,r,i+o,r+a)}function yt(t,e,n){var i=this;F(e,function(e){if(!n||n.intersects(e.bounds)){var r,o,a,s,u=ft(e,i),l=e.x||0,h=e.y||0,c=(null!=e.width?e.width:u.width)||0,f=(null!=e.height?e.height:u.height)||0;l-=dt(e.align,c),h-=vt(e.baseline,f),e.aspect!==!1&&(o=u.width/u.height,a=e.width/e.height,o===o&&a===a&&o!==a&&(a<o?(s=c/o,h+=(f-s)/2,f=s):(s=f*o,l+=(c-s)/2,c=s))),u.loaded&&(t.globalAlpha=null!=(r=e.opacity)?r:1,t.drawImage(u,l,h,c,f))}})}function _t(t,e){t("transform",dn(e)),t("d",e.path)}function mt(t,e){var n=e.path;if(null==n)return!0;var i=e.pathCache;i&&i.path===n||((e.pathCache=i=Oe(n)).path=n),De(t,i,e.x,e.y)}function xt(t,e){return mt(J(t),e)?t.set(0,0,0,0):Ke(t,e)}function bt(t,e){t("d",B(null,e))}function kt(t,e){var n,i;return Ke(t.set(n=e.x||0,i=e.y||0,n+e.width||0,i+e.height||0),e)}function wt(t,e){t.beginPath(),B(t,e)}function Tt(t,e){t("transform",dn(e)),t("x2",null!=e.x2?e.x2-(e.x||0):0),t("y2",null!=e.y2?e.y2-(e.y||0):0)}function Mt(t,e){var n,i;return Ke(t.set(n=e.x||0,i=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:i),e)}function Ct(t,e,n){var i,r,o,a;return!(!e.stroke||!hn(t,e,n))&&(i=e.x||0,r=e.y||0,o=null!=e.x2?e.x2:i,a=null!=e.y2?e.y2:r,t.beginPath(),t.moveTo(i,r),t.lineTo(o,a),!0)}function zt(t,e,n){F(e,function(e){if(!n||n.intersects(e.bounds)){var i=null==e.opacity?1:e.opacity;i&&Ct(t,e,i)&&t.stroke()}})}function At(t,e,n,i){return!!t.isPointInStroke&&(Ct(t,e,1)&&t.isPointInStroke(n,i))}function Pt(t){return on=Ot(t),St(It(t))}function St(t){return~~(.8*t.length*on)}function qt(t){return rn.font=Et(t),Lt(It(t))}function Lt(t){return rn.measureText(t).width}function Ot(t){return null!=t.fontSize?t.fontSize:11}function Rt(t){rn=t&&(rn=Ce(1,1))?rn.getContext("2d"):null,Cn.width=rn?qt:Pt}function It(t){var e=t.text;return null==e?"":t.limit>0?Nt(t):e+""}function Nt(t){var e=+t.limit,n=t.text+"",i=rn?(rn.font=Et(t),Lt):(on=Ot(t),St);if(i(n)<e)return n;var r,o=t.ellipsis||"â€¦",a="rtl"===t.dir,s=0,u=n.length;if(e-=i(o),a){for(;s<u;)r=s+u>>>1,i(n.slice(r))>e?s=r+1:u=r;return o+n.slice(s)}for(;s<u;)r=1+(s+u>>>1),i(n.slice(0,r))<e?s=r:u=r-1;return n.slice(0,s)+o}function Et(t,e){var n=t.font;return e&&n&&(n=String(n).replace(/\"/g,"'")),""+(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+Ot(t)+"px "+(n||"sans-serif")}function Dt(t){var e=t.baseline,n=Ot(t);return Math.round("top"===e?.93*n:"middle"===e?.3*n:"bottom"===e?-.21*n:0)}function Ht(t,e){var n,i=e.dx||0,r=(e.dy||0)+Dt(e),o=e.x||0,a=e.y||0,s=e.angle||0,u=e.radius||0;u&&(n=(e.theta||0)-Math.PI/2,o+=u*Math.cos(n),a+=u*Math.sin(n)),t("text-anchor",zn[e.align]||"start"),s?(n=fn(o,a)+" rotate("+s+")",(i||r)&&(n+=" "+fn(i,r))):n=fn(o+i,a+r),t("transform",n)}function Vt(t,e,n){var i,r,o=Cn.height(e),a=e.align,s=e.radius||0,u=e.x||0,l=e.y||0,h=e.dx||0,c=(e.dy||0)+Dt(e)-Math.round(.8*o);return s&&(r=(e.theta||0)-Math.PI/2,u+=s*Math.cos(r),l+=s*Math.sin(r)),i=Cn.width(e),"center"===a?h-=i/2:"right"===a&&(h-=i),t.set(h+=u,c+=l,h+i,c+o),e.angle&&!n&&t.rotate(e.angle*Math.PI/180,u,l),t.expand(n?0:1)}function Gt(t,e,n){F(e,function(e){var i,r,o,a,s,u;n&&!n.intersects(e.bounds)||(u=It(e))&&(i=null==e.opacity?1:e.opacity,0!==i&&(t.font=Et(e),t.textAlign=e.align||"left",r=e.x||0,o=e.y||0,(a=e.radius)&&(s=(e.theta||0)-Math.PI/2,r+=a*Math.cos(s),o+=a*Math.sin(s)),e.angle&&(t.save(),t.translate(r,o),t.rotate(e.angle*Math.PI/180),r=o=0),r+=e.dx||0,o+=(e.dy||0)+Dt(e),e.fill&&un(t,e,i)&&t.fillText(u,r,o),e.stroke&&hn(t,e,i)&&t.strokeText(u,r,o),e.angle&&t.restore()))})}function Wt(t,e,n,i,r,o){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var a=Vt(An,e,!0),s=-e.angle*Math.PI/180,u=Math.cos(s),l=Math.sin(s),h=e.x,c=e.y,f=u*r-l*o+(h-h*u+c*l),d=l*r+u*o+(c-h*l-c*u);return a.contains(f,d)}function Bt(t,e){return JSON.stringify(t,In,e)}function jt(t){var e="string"==typeof t?JSON.parse(t):t;return Ut(e)}function Ut(t){var e,n,i,r=t.marktype,o=t.items;if(o)for(n=0,i=o.length;n<i;++n)e=r?"mark":"group",o[n][e]=t,o[n].zindex&&(o[n][e].zdirty=!0),"group"===(r||e)&&Ut(o[n]);return r&&Rn(t),t}function Xt(t){arguments.length?this.root=jt(t):(this.root=Jt({marktype:"group",name:"root",role:"frame"}),this.root.items=[new s(this.root)])}function Jt(t,e){return{bounds:new o,bounds_prev:new o,clip:!!t.clip,group:e,interactive:t.interactive!==!1,items:[],marktype:t.marktype,name:t.name||void 0,role:t.role||void 0,zindex:t.zindex||0}}function Qt(t){this._active=null,this._handlers={},this._loader=t||n.loader()}function Yt(t){this._el=null,this._bgcolor=null,this._loader=new d(t)}function Zt(t){Qt.call(this,t),this._down=null,this._touch=null,this._first=!0}function $t(t,e,n){return function(i){var r=this._active,o=this.pickEvent(i);o===r?this.fire(t,i):(r&&r.exit||this.fire(n,i),this._active=o,this.fire(e,i),this.fire(t,i))}}function Ft(t){return function(e){this.fire(t,e),this._active=null}}function Kt(t){Yt.call(this,t),this._redraw=!1}function te(t,e){var n,i,r,a,s,u=new o;for(n=0,i=e.length;n<i;++n)r=e[n],a=r.mark,s=a.group,r=qn[a.marktype].nested?a:r,u.union(ee(r.bounds,s)),r.bounds_prev&&u.union(ee(r.bounds_prev,s));return u.expand(1).round(),t.beginPath(),t.rect(u.x1,u.y1,u.width(),u.height()),t.clip(),u}function ee(t,e){if(null==e)return t;for(var n=Un.clear().union(t);null!=e;e=e.mark.group)n.translate(e.x||0,e.y||0);return n}function ne(t){Qt.call(this,t);var e=this;e._hrefHandler=ie(e,function(t,n){n&&n.href&&e.handleHref(t,n,n.href)}),e._tooltipHandler=ie(e,function(t,n){n&&n.tooltip&&e.handleTooltip(t,n,"mouseover"===t.type?n.tooltip:null)})}function ie(t,e){return function(n){var i=n.target,r=i.__data__;n.vegaType=n.type,r=Array.isArray(r)?r[0]:r,e.call(t._obj,n,r)}}function re(t,e,n){var i,r,o="<"+t;if(e)for(i in e)r=e[i],null!=r&&(o+=" "+i+'="'+r+'"');return n&&(o+=" "+n),o+">"}function oe(t){return"</"+t+">"}function ae(t){Yt.call(this,t),this._dirtyID=0,this._svg=null,this._root=null,this._defs=null}function se(t,e,n){var i,r,o;for(t=h(t,n,"linearGradient",Zn),t.setAttribute("id",e.id),t.setAttribute("x1",e.x1),t.setAttribute("x2",e.x2),t.setAttribute("y1",e.y1),t.setAttribute("y2",e.y2),i=0,r=e.stops.length;i<r;++i)o=h(t,i,"stop",Zn),o.setAttribute("offset",e.stops[i].offset),o.setAttribute("stop-color",e.stops[i].color);c(t,i)}function ue(t,e,n){var i;t=h(t,n,"clipPath",Zn),t.setAttribute("id",e.id),i=h(t,0,"rect",Zn),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("width",e.width),i.setAttribute("height",e.height)}function le(t,e){for(;t&&t.dirty!==e;t=t.mark.group){if(t.dirty=e,!t.mark||t.mark.dirty===e)return;t.mark.dirty=e}}function he(t,e,n){e=e.lastChild;var i,r=0;F(n,function(n){i=t.draw(e,n,i),++r}),c(e,1+r)}function ce(t,e,n,i){var r,o=t._svg;if(!o&&(r=e.ownerDocument,o=u(r,i,Zn),t._svg=o,t.mark&&(o.__data__=t,o.__values__={fill:"default"},"g"===i))){var a=u(r,"path",Zn);a.setAttribute("class","background"),o.appendChild(a),a.__data__=t;var s=u(r,"g",Zn);o.appendChild(s),s.__data__=t}return(r||o.previousSibling!==n)&&e.insertBefore(o,n?n.nextSibling:e.firstChild),o}function fe(t,e,n){e!==ti[t]&&(null!=e?n?Kn.setAttributeNS(n,t,e):Kn.setAttribute(t,e):n?Kn.removeAttributeNS(n,t):Kn.removeAttribute(t),ti[t]=e)}function de(){return"undefined"!=typeof window?window.location.href:""}function ve(t){Yt.call(this,t),this._text={head:"",root:"",foot:"",defs:"",body:""},this._defs={clip_id:1,gradient:{},clipping:{}}}function ge(t,e,n,i){ri[i||t]=e}function pe(t,e,n,i){if(null==t)return"";var r,o,a,s,u,l="";for("bgrect"===n&&e.interactive===!1&&(l+="pointer-events: none;"),"text"===n&&(l+="font: "+Et(t)+";"),r=0,o=Yn.length;r<o;++r)a=Yn[r],s=Qn[a],u=t[a],null==u?"fill"===s&&(l+=(l.length?" ":"")+"fill: none;"):(u.id&&(i.gradient[u.id]=u,u="url(#"+u.id+")"),l+=(l.length?" ":"")+s+": "+u+";");return l?'style="'+l+'"':null}function ye(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function _e(t,e){return t=String(t||"").toLowerCase(),arguments.length>1?(hi[t]=e,this):hi[t]}function me(t,n,i){return t===n||("path"===i?xe(t,n):t instanceof Date&&n instanceof Date?+t===+n:e.isNumber(t)&&e.isNumber(n)?Math.abs(t-n)<=ci:t&&n&&(e.isObject(t)||e.isObject(n))?null!=t&&null!=n&&be(t,n):t==n)}function xe(t,e){return me(Oe(t),Oe(e))}function be(t,e){var n,i,r=Object.keys(t),o=Object.keys(e);if(r.length!==o.length)return!1;for(r.sort(),o.sort(),i=r.length-1;i>=0;i--)if(r[i]!=o[i])return!1;for(i=r.length-1;i>=0;i--)if(n=r[i],!me(t[n],e[n],n))return!1;return typeof t==typeof e}var ke=o.prototype;ke.clone=function(){return new o(this)},ke.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},ke.set=function(t,e,n,i){return n<t?(this.x2=t,this.x1=n):(this.x1=t,this.x2=n),i<e?(this.y2=e,this.y1=i):(this.y1=e,this.y2=i),this},ke.add=function(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},ke.expand=function(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},ke.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},ke.translate=function(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},ke.rotate=function(t,e,n){var i=Math.cos(t),r=Math.sin(t),o=e-e*i+n*r,a=n-e*r-n*i,s=this.x1,u=this.x2,l=this.y1,h=this.y2;return this.clear().add(i*s-r*l+o,r*s+i*l+a).add(i*s-r*h+o,r*s+i*h+a).add(i*u-r*l+o,r*u+i*l+a).add(i*u-r*h+o,r*u+i*h+a)},ke.union=function(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},ke.encloses=function(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},ke.alignsWith=function(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},ke.intersects=function(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},ke.contains=function(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},ke.width=function(){return this.x2-this.x1},ke.height=function(){return this.y2-this.y1};var we=0,Te=function(t,e){var n,i=[];return n={id:"gradient_"+we++,x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:i,stop:function(t,e){return i.push({offset:t,color:e}),n}}};e.inherits(s,a);var Me;try{Me=require("canvas")}catch(t){Me=null}var Ce=function(t,e){var n=u(null,"canvas");return n?(n.width=t,n.height=e):Me&&(n=new Me(t,e)),n},ze="undefined"!=typeof Image?Image:Me&&Me.Image||null,Ae=d.prototype;Ae.pending=function(){return this._pending},Ae.sanitizeURL=function(t){var e=this;return v(e),e._loader.sanitize(t,{context:"href"}).then(function(t){return g(e),t}).catch(function(){return g(e),null})},Ae.loadImage=function(t){var e=this;return v(e),e._loader.sanitize(t,{context:"image"}).then(function(t){var n=t.href;if(!n||!ze)throw"Image unsupported.";var i=new ze;return i.onload=function(){g(e),i.loaded=!0},i.onerror=function(){g(e),i.loaded=!1},i.src=n,i}).catch(function(){return g(e),{loaded:!1,width:0,height:0}})},Ae.ready=function(){var t=this;return new Promise(function(e){function n(i){t.pending()?setTimeout(function(){n(!0)},10):e(i)}n(!1)})};var Pe,Se={basis:{curve:i.curveBasis},"basis-closed":{curve:i.curveBasisClosed},"basis-open":{curve:i.curveBasisOpen},bundle:{curve:i.curveBundle,tension:"beta",value:.85},cardinal:{curve:i.curveCardinal,tension:"tension",value:0},"cardinal-open":{curve:i.curveCardinalOpen,tension:"tension",value:0},"cardinal-closed":{curve:i.curveCardinalClosed,tension:"tension",value:0},"catmull-rom":{curve:i.curveCatmullRom,tension:"alpha",value:.5},"catmull-rom-closed":{curve:i.curveCatmullRomClosed,tension:"alpha",value:.5},"catmull-rom-open":{curve:i.curveCatmullRomOpen,tension:"alpha",value:.5},linear:{curve:i.curveLinear},"linear-closed":{curve:i.curveLinearClosed},monotone:{horizontal:i.curveMonotoneY,vertical:i.curveMonotoneX},natural:{curve:i.curveNatural},step:{curve:i.curveStep},"step-after":{curve:i.curveStepAfter},"step-before":{curve:i.curveStepBefore}},qe={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Le=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)([-+])/g,/\s|,|###/],Oe=function(t){var e,n,i,r,o,a,s,u,l,h,c,f=[];for(e=t.slice().replace(Le[0],"###$1").split(Le[1]).slice(1),u=0,h=e.length;u<h;++u){for(n=e[u],i=n.slice(1).trim().replace(Le[2],"$1###$2").split(Le[3]),a=n.charAt(0),r=[a],l=0,c=i.length;l<c;++l)(o=+i[l])===o&&r.push(o);if(s=qe[a.toLowerCase()],r.length-1>s)for(l=1,c=r.length;l<c;l+=s)f.push([a].concat(r.slice(l,l+s)));else f.push(r)}return f},Re={},Ie={},Ne=[].join,Ee=["l",0,0,0,0,0,0,0],De=function(t,e,n,i,r){var o,a,s,u,l,h=null,c=0,f=0,d=0,v=0;null==n&&(n=0),null==i&&(i=0),null==r&&(r=1),t.beginPath&&t.beginPath();for(var g=0,p=e.length;g<p;++g){switch(o=e[g],1!==r&&(o=m(o,r)),o[0]){case"l":c+=o[1],f+=o[2],t.lineTo(c+n,f+i);break;case"L":c=o[1],f=o[2],t.lineTo(c+n,f+i);break;case"h":c+=o[1],t.lineTo(c+n,f+i);break;case"H":c=o[1],t.lineTo(c+n,f+i);break;case"v":f+=o[1],t.lineTo(c+n,f+i);break;case"V":f=o[1],t.lineTo(c+n,f+i);break;case"m":c+=o[1],f+=o[2],t.moveTo(c+n,f+i);break;case"M":c=o[1],f=o[2],t.moveTo(c+n,f+i);break;case"c":a=c+o[5],s=f+o[6],d=c+o[3],v=f+o[4],t.bezierCurveTo(c+o[1]+n,f+o[2]+i,d+n,v+i,a+n,s+i),c=a,f=s;break;case"C":c=o[5],f=o[6],d=o[3],v=o[4],t.bezierCurveTo(o[1]+n,o[2]+i,d+n,v+i,c+n,f+i);break;case"s":a=c+o[3],s=f+o[4],d=2*c-d,v=2*f-v,t.bezierCurveTo(d+n,v+i,c+o[1]+n,f+o[2]+i,a+n,s+i),d=c+o[1],v=f+o[2],c=a,f=s;break;case"S":a=o[3],s=o[4],d=2*c-d,v=2*f-v,t.bezierCurveTo(d+n,v+i,o[1]+n,o[2]+i,a+n,s+i),c=a,f=s,d=o[1],v=o[2];break;case"q":a=c+o[3],s=f+o[4],d=c+o[1],v=f+o[2],t.quadraticCurveTo(d+n,v+i,a+n,s+i),c=a,f=s;break;case"Q":a=o[3],s=o[4],t.quadraticCurveTo(o[1]+n,o[2]+i,a+n,s+i),c=a,f=s,d=o[1],v=o[2];break;case"t":a=c+o[1],s=f+o[2],null===h[0].match(/[QqTt]/)?(d=c,v=f):"t"===h[0]?(d=2*c-u,v=2*f-l):"q"===h[0]&&(d=2*c-d,v=2*f-v),u=d,l=v,t.quadraticCurveTo(d+n,v+i,a+n,s+i),c=a,f=s,d=c+o[1],v=f+o[2];break;case"T":a=o[1],s=o[2],d=2*c-d,v=2*f-v,t.quadraticCurveTo(d+n,v+i,a+n,s+i),c=a,f=s;break;case"a":x(t,c+n,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+c+n,o[7]+f+i]),c+=o[6],f+=o[7];break;case"A":x(t,c+n,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]),c=o[6],f=o[7];break;case"z":case"Z":t.closePath()}h=o}},He=2*Math.PI,Ve=Math.sqrt(3)/2,Ge={circle:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(n,0),t.arc(0,0,n,0,He)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/2.5;t.moveTo(-n,-i),t.lineTo(-n,i),t.lineTo(-i,i),t.lineTo(-i,n),t.lineTo(i,n),t.lineTo(i,i),t.lineTo(n,i),t.lineTo(n,-i),t.lineTo(i,-i),t.lineTo(i,-n),t.lineTo(-i,-n),t.lineTo(-i,-i),t.closePath()}},diamond:{draw:function(t,e){var n=Math.sqrt(e)/2;t.moveTo(-n,0),t.lineTo(0,-n),t.lineTo(n,0),t.lineTo(0,n),t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Ve*n;t.moveTo(0,-i),t.lineTo(-n,i),t.lineTo(n,i),t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Ve*n;t.moveTo(0,i),t.lineTo(-n,-i),t.lineTo(n,-i),t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Ve*n;t.moveTo(i,0),t.lineTo(-i,-n),t.lineTo(-i,n),t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Ve*n;t.moveTo(-i,0),t.lineTo(i,-n),t.lineTo(i,n),t.closePath()}}},We={},Be=function(){function t(t,u,l){var h,c=null!=u?u:+e.call(this,t),f=null!=l?l:+n.call(this,t),d=+i.call(this,t),v=+o.call(this,t),g=+a.call(this,t);if(s||(s=h=r.path()),g<=0)s.rect(c,f,d,v);else{var p=c+d,y=f+v;s.moveTo(c+g,f),s.lineTo(p-g,f),s.quadraticCurveTo(p,f,p,f+g),s.lineTo(p,y-g),s.quadraticCurveTo(p,y,p-g,y),s.lineTo(c+g,y),s.quadraticCurveTo(c,y,c,y-g),s.lineTo(c,f+g),s.quadraticCurveTo(c,f,c+g,f),s.closePath()}if(h)return s=null,h+""||null}var e=w,n=T,i=M,o=C,a=z(0),s=null;return t.x=function(n){return arguments.length?(e="function"==typeof n?n:z(+n),t):e},t.y=function(e){return arguments.length?(n="function"==typeof e?e:z(+e),t):n},t.width=function(e){return arguments.length?(i="function"==typeof e?e:z(+e),t):i},t.height=function(e){return arguments.length?(o="function"==typeof e?e:z(+e),t):o},t.cornerRadius=function(e){return arguments.length?(a="function"==typeof e?e:z(+e),t):a},t.context=function(e){return arguments.length?(s=null==e?null:e,t):s},t},je=Math.PI,Ue=function(){function t(t,e,n){var i=n/2;if(s){var r=l-e,o=t-u,a=Math.sqrt(r*r+o*o),f=(r/=a)*h,d=(o/=a)*h,v=Math.atan2(o,r);c.moveTo(u-f,l-d),c.lineTo(t-r*i,e-o*i),c.arc(t,e,i,v-je,v),c.lineTo(u+f,l+d),c.arc(u,l,h,v,v+je),c.closePath()}else s=1;u=t,l=e,h=i}function e(e){var u,l,h,f=e.length,d=!1;for(null==c&&(c=h=r.path()),u=0;u<=f;++u)!(u<f&&a(l=e[u],u,e))===d&&(d=!d)&&(s=0),d&&t(+n(l,u,e),+i(l,u,e),+o(l,u,e));if(h)return c=null,h+""||null}var n,i,o,a,s,u,l,h,c=null;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e.size=function(t){return arguments.length?(o=t,e):o},e.defined=function(t){return arguments.length?(a=t,e):a},e.context=function(t){return arguments.length?(c=null==t?null:t,e):c},e},Xe=i.arc().cornerRadius(I).padAngle(N),Je=i.area().x(A).y1(P).y0(R).defined(E),Qe=i.area().y(P).x1(A).x0(O).defined(E),Ye=i.line().x(A).y(P).defined(E),Ze=Be().x(A).y(P).width(S).height(L).cornerRadius(I),$e=i.symbol().type(H).size(D),Fe=Ue().x(A).y(P).defined(E).size(q),Ke=function(t,e){return e.stroke&&0!==e.opacity&&0!==e.strokeOpacity&&t.expand(null!=e.strokeWidth?+e.strokeWidth:1),t},tn=2*Math.PI,en=tn/4,nn=tn-1e-8;J.beginPath=Q,J.closePath=Q,J.moveTo=Y,J.lineTo=Y,J.rect=function(t,e,n,i){Y(t,e),Y(t+n,e+i)},J.quadraticCurveTo=function(t,e,n,i){Y(t,e),Y(n,i)},J.bezierCurveTo=function(t,e,n,i,r,o){Y(t,e),Y(n,i),Y(r,o)},J.arc=function(t,e,n,i,r,o){function a(t){l=n*Math.cos(t),h=n*Math.sin(t),l<c&&(c=l),l>f&&(f=l),h<d&&(d=h),h>v&&(v=h)}if(Math.abs(r-i)>nn)return Y(t-n,e-n),void Y(t+n,e+n);var s,u,l,h,c=1/0,f=-(1/0),d=1/0,v=-(1/0);if(a(i),a(r),r!==i)if(i%=tn,i<0&&(i+=tn),r%=tn,r<0&&(r+=tn),r<i&&(o=!o,s=i,i=r,r=s),o)for(r-=tn,s=i-i%en,u=0;u<3&&s>r;++u,s-=en)a(s);else for(s=i-i%en+en,u=0;u<3&&s<r;++u,s+=en)a(s);Y(t+c,e+d),Y(t+f,e+v)};var rn,on,an=function(t,e,n){for(var i=n.width(),r=n.height(),o=n.x1+e.x1*i,a=n.y1+e.y1*r,s=n.x1+e.x2*i,u=n.y1+e.y2*r,l=e.stops,h=0,c=l.length,f=t.createLinearGradient(o,a,s,u);h<c;++h)f.addColorStop(l[h].offset,l[h].color);return f},sn=function(t,e,n){return n.id?an(t,n,e.bounds):n},un=function(t,e,n){return n*=null==e.fillOpacity?1:e.fillOpacity,n>0&&(t.globalAlpha=n,t.fillStyle=sn(t,e,e.fill),!0)},ln=[],hn=function(t,e,n){var i,r=null!=(r=e.strokeWidth)?r:1;return!(r<=0)&&(n*=null==e.strokeOpacity?1:e.strokeOpacity,n>0&&(t.globalAlpha=n,t.strokeStyle=sn(t,e,e.stroke),t.lineWidth=r,t.lineCap=null!=(i=e.strokeCap)?i:"butt",t.setLineDash&&(t.setLineDash(e.strokeDash||ln),t.lineDashOffset=e.strokeDashOffset||0),!0))},cn=function(){return!0},fn=function(t,e){return"translate("+t+","+e+")"},dn=function(t){return fn(t.x||0,t.y||0)},vn=function(t,e){function n(t,n){t("transform",dn(n)),t("d",e(null,n))}function i(t,n){return e(J(t),n),Ke(t,n).translate(n.x||0,n.y||0)}function r(t,n){var i=n.x||0,r=n.y||0;t.translate(i,r),t.beginPath(),e(t,n),t.translate(-i,-r)}return{type:t,tag:"path",nested:!1,attr:n,bound:i,draw:tt(r),pick:ot(r)}},gn=vn("arc",V),pn=function(t,e){function n(t,n){var i=n.mark.items;i.length&&t("d",e(null,i))}function i(t,n){var i=n.items;return 0===i.length?t:(e(J(t),i),Ke(t,i[0]))}function r(t,n){t.beginPath(),e(t,n)}function o(t,e,n,i,r,o){var s=e.items,u=e.bounds;return!s||!s.length||u&&!u.contains(r,o)?null:(t.pixelRatio>1&&(n*=t.pixelRatio,i*=t.pixelRatio),a(t,s,n,i)?s[0]:null)}var a=rt(r);return{type:t,tag:"path",nested:!0,attr:n,bound:i,draw:et(r),pick:o}},yn=pn("area",G),_n={type:"group",tag:"g",nested:!1,attr:at,bound:lt,draw:ht,pick:ct,background:st,foreground:ut},mn={type:"image",tag:"image",nested:!1,attr:gt,bound:pt,draw:yt,pick:it(),get:ft,xOffset:dt,yOffset:vt},xn=pn("line",W),bn={type:"path",tag:"path",nested:!1,attr:_t,bound:xt,draw:tt(mt),pick:ot(mt)},kn={type:"rect",tag:"path",nested:!1,attr:bt,bound:kt,draw:tt(wt),pick:ot(wt)},wn={type:"rule",tag:"line",nested:!1,attr:Tt,bound:Mt,draw:zt,pick:it(At)},Tn=vn("shape",j),Mn=vn("symbol",U),Cn={height:Ot,measureWidth:qt,estimateWidth:Pt,width:Pt,canvas:Rt};Rt(!0);var zn={left:"start",center:"middle",right:"end"},An=new o,Pn={type:"text",tag:"text",nested:!1,attr:Ht,bound:Vt,draw:Gt,pick:it(Wt)},Sn=pn("trail",X),qn={arc:gn,area:yn,group:_n,image:mn,line:xn,path:bn,rect:kn,rule:wn,shape:Tn,symbol:Mn,text:Pn,trail:Sn},Ln=function(t,e,n){var i=qn[t.mark.marktype],r=e||i.bound;i.nested&&(t=t.mark);var a=t.bounds,s=t.bounds_prev||(t.bounds_prev=new o);return a?(s.clear().union(a),a.clear()):t.bounds=new o,r(t.bounds,t,n),a||s.clear().union(t.bounds),t.bounds},On={mark:null},Rn=function(t,e,n){var i,r,a,s,u=qn[t.marktype],l=u.bound,h=t.items,c=h&&h.length;if(u.nested)return a=c?h[0]:(On.mark=t,On),s=Ln(a,l,n),e=e&&e.union(s)||s;if(e=e||t.bounds&&t.bounds.clear()||new o,c)for(i=0,r=h.length;i<r;++i)e.union(Ln(h[i],l,n));return t.bounds=e},In=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","interpolate","tension","orient","defined","url","path","x2","y2","size","shape","text","angle","theta","radius","dx","dy","font","fontSize","fontWeight","fontStyle","fontVariant"],Nn=Xt.prototype;Nn.toJSON=function(t){return Bt(this.root,t||0)},Nn.mark=function(t,e,n){e=e||this.root.items[0];var i=Jt(t,e);return e.items[n]=i,i.zindex&&(i.group.zdirty=!0),i};var En=Qt.prototype;En.initialize=function(t,e,n){return this._el=t,this._obj=n||null,this.origin(e)},En.element=function(){return this._el},En.origin=function(t){return this._origin=t||[0,0],this},En.scene=function(t){return arguments.length?(this._scene=t,this):this._scene},En.on=function(){},En.off=function(){},En.handlers=function(){var t,e=this._handlers,n=[];for(t in e)n.push.apply(n,e[t]);return n},En.eventName=function(t){var e=t.indexOf(".");return e<0?t:t.slice(0,e)},En.handleHref=function(t,e,n){this._loader.sanitize(n,{context:"href"}).then(function(e){var n=new MouseEvent(t.type,t),i=u(null,"a");for(var r in e)i.setAttribute(r,e[r]);i.dispatchEvent(n)}).catch(function(){})},En.handleTooltip=function(t,e,n){this._el.setAttribute("title",n||"")};var Dn=Yt.prototype;Dn.initialize=function(t,e,n,i){return this._el=t,this.resize(e,n,i)},Dn.element=function(){return this._el},Dn.scene=function(){return this._el&&this._el.firstChild},Dn.background=function(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},Dn.resize=function(t,e,n){return this._width=t,this._height=e,this._origin=n||[0,0],this},Dn.render=function(t,e){var n=this;return n._call=function(){n._render(t,e)},n._call(),n._call=null,n},Dn._render=function(){},Dn.renderAsync=function(t,e){var n=this.render(t,e);return this._ready?this._ready.then(function(){return n}):Promise.resolve(n)},Dn._load=function(t,e){var n=this,i=n._loader[t](e);if(!n._ready){var r=n._call;n._ready=n._loader.ready().then(function(t){t&&r(),n._ready=null})}return i},Dn.sanitizeURL=function(t){return this._load("sanitizeURL",t)},Dn.loadImage=function(t){return this._load("loadImage",t)};var Hn=function(t,e){var n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]},Vn=e.inherits(Zt,Qt);Vn.initialize=function(t,e,n){var i=this._canvas=t&&l(t,"canvas");if(i){var r=this;this.events.forEach(function(t){i.addEventListener(t,function(e){Vn[t]?Vn[t].call(r,e):r.fire(t,e)})})}return Qt.prototype.initialize.call(this,t,e,n)},Vn.canvas=function(){return this._canvas},Vn.context=function(){return this._canvas.getContext("2d")},Vn.events=["keydown","keypress","keyup","dragenter","dragleave","dragover","mousedown","mouseup","mousemove","mouseout","mouseover","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],Vn.DOMMouseScroll=function(t){this.fire("mousewheel",t)},Vn.mousemove=$t("mousemove","mouseover","mouseout"),Vn.dragover=$t("dragover","dragenter","dragleave"),Vn.mouseout=Ft("mouseout"),Vn.dragleave=Ft("dragleave"),
Vn.mousedown=function(t){this._down=this._active,this.fire("mousedown",t)},Vn.click=function(t){this._down===this._active&&(this.fire("click",t),this._down=null)},Vn.touchstart=function(t){this._touch=this.pickEvent(t.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire("touchstart",t,!0)},Vn.touchmove=function(t){this.fire("touchmove",t,!0)},Vn.touchend=function(t){this.fire("touchend",t,!0),this._touch=null},Vn.fire=function(t,e,n){var i,r,o=n?this._touch:this._active,a=this._handlers[t];if("click"===t&&o&&o.href?this.handleHref(e,o,o.href):("mouseover"===t||"mouseout"===t)&&o&&o.tooltip&&this.handleTooltip(e,o,"mouseover"===t?o.tooltip:null),a)for(e.vegaType=t,i=0,r=a.length;i<r;++i)a[i].handler.call(this._obj,e,o)},Vn.on=function(t,e){var n=this.eventName(t),i=this._handlers;return(i[n]||(i[n]=[])).push({type:t,handler:e}),this},Vn.off=function(t,e){var n,i=this.eventName(t),r=this._handlers[i];if(r){for(n=r.length;--n>=0;)r[n].type===t&&(e&&r[n].handler!==e||r.splice(n,1));return this}},Vn.pickEvent=function(t){var e=Hn(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},Vn.pick=function(t,e,n,i,r){var o=this.context(),a=qn[t.marktype];return a.pick.call(this,o,t,e,n,i,r)};var Gn="undefined"!=typeof window?window.devicePixelRatio||1:1,Wn=function(t,e,n,i){var r="undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&null!=t.parentNode,o=t.getContext("2d"),a=r?Gn:1;return t.width=e*a,t.height=n*a,1!==a&&(t.style.width=e+"px",t.style.height=n+"px"),o.pixelRatio=a,o.setTransform(a,0,0,a,a*i[0],a*i[1]),t},Bn=e.inherits(Kt,Yt),jn=Yt.prototype,Un=new o;Bn.initialize=function(t,e,n,i){return this._canvas=Ce(1,1),t&&(c(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),jn.initialize.call(this,t,e,n,i)},Bn.resize=function(t,e,n){return jn.resize.call(this,t,e,n),Wn(this._canvas,this._width,this._height,this._origin),this._redraw=!0,this},Bn.canvas=function(){return this._canvas},Bn.context=function(){return this._canvas?this._canvas.getContext("2d"):null},Bn._render=function(t,e){var n,i=this.context(),r=this._origin,o=this._width,a=this._height;return i.save(),n=!e||this._redraw?(this._redraw=!1,null):te(i,e),this.clear(-r[0],-r[1],o,a),this.draw(i,t,n),i.restore(),this},Bn.draw=function(t,e,n){var i=qn[e.marktype];i.draw.call(this,t,e,n)},Bn.clear=function(t,e,n,i){var r=this.context();r.clearRect(t,e,n,i),null!=this._bgcolor&&(r.fillStyle=this._bgcolor,r.fillRect(t,e,n,i))};var Xn=e.inherits(ne,Qt);Xn.initialize=function(t,e,n){var i=this._svg;return i&&(i.removeEventListener("click",this._hrefHandler),i.removeEventListener("mouseover",this._tooltipHandler),i.removeEventListener("mouseout",this._tooltipHandler)),this._svg=i=t&&l(t,"svg"),i&&(i.addEventListener("click",this._hrefHandler),i.addEventListener("mouseover",this._tooltipHandler),i.addEventListener("mouseout",this._tooltipHandler)),Qt.prototype.initialize.call(this,t,e,n)},Xn.svg=function(){return this._svg},Xn.on=function(t,e){var n=this.eventName(t),i=this._handlers,r={type:t,handler:e,listener:ie(this,e)};return(i[n]||(i[n]=[])).push(r),this._svg&&this._svg.addEventListener(n,r.listener),this},Xn.off=function(t,e){var n,i=this.eventName(t),r=this._svg,o=this._handlers[i];if(o){for(n=o.length;--n>=0;)(o[n].type===t&&!e||o[n].handler===e)&&(this._svg&&r.removeEventListener(i,o[n].listener),o.splice(n,1));return this}};var Jn={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},Qn={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},Yn=Object.keys(Qn),Zn=Jn.xmlns,$n=e.inherits(ae,Yt),Fn=Yt.prototype;$n.initialize=function(t,e,n,i){return t&&(this._svg=h(t,0,"svg",Zn),this._svg.setAttribute("class","marks"),c(t,1),this._root=h(this._svg,0,"g",Zn),c(this._svg,1)),this._defs={clip_id:1,gradient:{},clipping:{}},this.background(this._bgcolor),Fn.initialize.call(this,t,e,n,i)},$n.background=function(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),Fn.background.apply(this,arguments)},$n.resize=function(t,e,n){return Fn.resize.call(this,t,e,n),this._svg&&(this._svg.setAttribute("width",this._width),this._svg.setAttribute("height",this._height),this._svg.setAttribute("viewBox","0 0 "+this._width+" "+this._height),this._root.setAttribute("transform","translate("+this._origin+")")),this},$n.svg=function(){if(!this._svg)return null;var t={class:"marks",width:this._width,height:this._height,viewBox:"0 0 "+this._width+" "+this._height};for(var e in Jn)t[e]=Jn[e];return re("svg",t)+this._svg.innerHTML+oe("svg")},$n._render=function(t,e){return this._dirtyCheck(e)&&(this._dirtyAll&&this._resetDefs(),this.draw(this._root,t),c(this._root,1)),this.updateDefs(),this},$n.updateDefs=function(){var t,e=this._svg,n=this._defs,i=n.el,r=0;for(t in n.gradient)i||(n.el=i=h(e,0,"defs",Zn)),se(i,n.gradient[t],r++);for(t in n.clipping)i||(n.el=i=h(e,0,"defs",Zn)),ue(i,n.clipping[t],r++);i&&(0===r?(e.removeChild(i),n.el=null):c(i,r))},$n._resetDefs=function(){var t=this._defs;t.clip_id=1,t.gradient={},t.clipping={}},$n.isDirty=function(t){return this._dirtyAll||!t._svg||t.dirty===this._dirtyID},$n._dirtyCheck=function(t){if(this._dirtyAll=!0,!t)return!0;var e,n,i,r,o,a,s,u=++this._dirtyID;for(o=0,a=t.length;o<a;++o)e=t[o],n=e.mark,n.marktype!==i&&(i=n.marktype,r=qn[i]),n.zdirty&&n.dirty!==u&&(this._dirtyAll=!1,n.dirty=u,le(n.group,u)),e.exit?(r.nested&&n.items.length?(s=n.items[0],s._svg&&this._update(r,s._svg,s)):e._svg&&e._svg.parentNode.removeChild(e._svg),e._svg=null):(e=r.nested?n.items[0]:e,e._update!==u&&(e._svg&&e._svg.ownerSVGElement?this._update(r,e._svg,e):(this._dirtyAll=!1,le(e,u)),e._update=u));return!this._dirtyAll},$n.draw=function(t,e,n){function i(t){var e=o.isDirty(t),n=ce(t,r,l,a.tag);e&&(o._update(a,n,t),u&&he(o,n,t)),l=n,++h}if(!this.isDirty(e))return e._svg;var r,o=this,a=qn[e.marktype],s=e.interactive===!1?"none":null,u="g"===a.tag,l=null,h=0;return r=ce(e,t,n,"g"),r.setAttribute("class",f(e)),!u&&s&&r.style.setProperty("pointer-events",s),a.nested?e.items.length&&i(e.items[0]):F(e,i),c(r,h),r};var Kn=null,ti=null,ei={group:function(t,e,n){ti=e.__values__,Kn=e.childNodes[1],t.foreground(fe,n,this),Kn=e.childNodes[0],t.background(fe,n,this);var i=n.mark.interactive===!1?"none":null;i!==ti.events&&(Kn.style.setProperty("pointer-events",i),ti.events=i)},text:function(t,e,n){var i=It(n);i!==ti.text&&(e.textContent=i,ti.text=i),i=Et(n),i!==ti.font&&(e.style.setProperty("font",i),ti.font=i)}};$n._update=function(t,e,n){Kn=e,ti=e.__values__,t.attr(fe,n,this);var i=ei[t.type];i&&i.call(this,t,e,n),this.style(Kn,n)},$n.style=function(t,e){if(null!=e){var n,i,r,o,a;for(n=0,i=Yn.length;n<i;++n)r=Yn[n],a=e[r],a!==ti[r]&&(o=Qn[r],null==a?"fill"===o?t.style.setProperty(o,"none"):t.style.removeProperty(o):(a.id&&(this._defs.gradient[a.id]=a,a="url("+de()+"#"+a.id+")"),t.style.setProperty(o,a+"")),ti[r]=a)}};var ni=e.inherits(ve,Yt),ii=Yt.prototype;ni.resize=function(t,e,n){ii.resize.call(this,t,e,n);var i=this._origin,r=this._text,o={class:"marks",width:this._width,height:this._height,viewBox:"0 0 "+this._width+" "+this._height};for(var a in Jn)o[a]=Jn[a];return r.head=re("svg",o),r.root=re("g",{transform:"translate("+i+")"}),r.foot=oe("g")+oe("svg"),this},ni.svg=function(){var t=this._text;return t.head+t.defs+t.root+t.body+t.foot},ni._render=function(t){return this._text.body=this.mark(t),this._text.defs=this.buildDefs(),this},ni.reset=function(){return this._defs.clip_id=0,this},ni.buildDefs=function(){var t,e,n,i,r=this._defs,o="";for(e in r.gradient){for(n=r.gradient[e],i=n.stops,o+=re("linearGradient",{id:e,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),t=0;t<i.length;++t)o+=re("stop",{offset:i[t].offset,"stop-color":i[t].color})+oe("stop");o+=oe("linearGradient")}for(e in r.clipping)n=r.clipping[e],o+=re("clipPath",{id:e}),o+=re("rect",{x:0,y:0,width:n.width,height:n.height})+oe("rect"),o+=oe("clipPath");return o.length>0?re("defs")+o+oe("defs"):""};var ri;ni.attributes=function(t,e){return ri={},t(ge,e,this),ri},ni.href=function(t){var e,n=this,i=t.href;if(i){if(e=n._hrefs&&n._hrefs[i])return e;n.sanitizeURL(i).then(function(t){t["xlink:href"]=t.href,t.href=null,(n._hrefs||(n._hrefs={}))[i]=t})}return null},ni.mark=function(t){function e(e){var u=i.href(e);u&&(s+=re("a",u)),n="g"!==o?pe(e,t,o,a):null,s+=re(o,i.attributes(r.attr,e),n),"text"===o?s+=ye(It(e)):"g"===o&&(s+=re("path",i.attributes(r.background,e),pe(e,t,"bgrect",a))+oe("path"),s+=re("g",i.attributes(r.foreground,e))+i.markGroup(e)+oe("g")),s+=oe(o),u&&(s+=oe("a"))}var n,i=this,r=qn[t.marktype],o=r.tag,a=this._defs,s="";return"g"!==o&&t.interactive===!1&&(n='style="pointer-events: none;"'),s+=re("g",{class:f(t)},n),r.nested?t.items&&t.items.length&&e(t.items[0]):F(t,e),s+oe("g")},ni.markGroup=function(t){var e=this,n="";return F(t,function(t){n+=e.mark(t)}),n};var oi="canvas",ai="png",si="svg",ui="none",li={Canvas:oi,PNG:ai,SVG:si,None:ui},hi={};hi[oi]=hi[ai]={renderer:Kt,headless:Kt,handler:Zt},hi[si]={renderer:ae,headless:ve,handler:ne},hi[ui]={};var ci=1e-9;t.Bounds=o,t.Gradient=Te,t.GroupItem=s,t.ResourceLoader=d,t.Item=a,t.Scenegraph=Xt,t.Handler=Qt,t.Renderer=Yt,t.CanvasHandler=Zt,t.CanvasRenderer=Kt,t.SVGHandler=ne,t.SVGRenderer=ae,t.SVGStringRenderer=ve,t.RenderType=li,t.renderModule=_e,t.Marks=qn,t.boundContext=J,t.boundStroke=Ke,t.boundItem=Ln,t.boundMark=Rn,t.pathCurves=p,t.pathSymbols=b,t.pathRectangle=Be,t.pathTrail=Ue,t.pathParse=Oe,t.pathRender=De,t.point=Hn,t.canvas=Ce,t.domCreate=u,t.domFind=l,t.domChild=h,t.domClear=c,t.openTag=re,t.closeTag=oe,t.font=Et,t.textMetrics=Cn,t.sceneEqual=me,t.pathEqual=xe,t.sceneToJSON=Bt,t.sceneFromJSON=jt,t.sceneZOrder=$,t.sceneVisit=F,t.scenePickVisit=K,Object.defineProperty(t,"__esModule",{value:!0})});