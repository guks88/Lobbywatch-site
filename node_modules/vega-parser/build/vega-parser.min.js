!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-expression"),require("d3-color"),require("d3-array"),require("d3-format"),require("d3-time-format"),require("vega-scale"),require("vega-scenegraph"),require("vega-event-selector"),require("vega-dataflow")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-expression","d3-color","d3-array","d3-format","d3-time-format","vega-scale","vega-scenegraph","vega-event-selector","vega-dataflow"],t):t(e.vega=e.vega||{},e.vega,e.vega,e.d3,e.d3,e.d3,e.d3,e.vega,e.vega,e.vega,e.vega)}(this,function(e,t,n,a,r,i,o,l,s,u,d){"use strict";function c(e,n){t.error(e+' for "outer" push: '+t.stringValue(n))}function f(e){var t={};return function(n,a){var r=t[a]||(t[a]=e(a));return r(n)}}function p(e,t,n){return Ot.setMonth(e),Ot.setDate(t),$t(Ot,n)}function g(e){return p(e,1,"%B")}function h(e){return p(e,1,"%b")}function m(e){return p(0,2+e,"%A")}function v(e){return p(0,2+e,"%a")}function y(e){return 1+~~(new Date(e).getMonth()/3)}function x(e){return 1+~~(new Date(e).getUTCMonth()/3)}function b(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function k(){return b(this.context.dataflow,"warn",arguments)}function S(){return b(this.context.dataflow,"info",arguments)}function R(){return b(this.context.dataflow,"debug",arguments)}function w(){return"Math.sqrt(Math.pow(event.touches[0].clientX - event.touches[1].clientX, 2) + Math.pow(event.touches[0].clientY - event.touches[1].clientY, 2))"}function z(){return"Math.atan2(event.touches[1].clientY - event.touches[0].clientY,event.touches[1].clientX - event.touches[0].clientX)"}function P(e,t){var n=this.context.dataflow;Vt&&Vt.open?n.loader().sanitize(e,{context:"open",name:t}).then(function(e){Vt.open(e,t)}).catch(function(e){n.warn("Open url failed: "+e)}):n.warn("Open function can only be invoked in a browser.")}function $(){return Vt?Vt.screen:{}}function _(){return Vt?[Vt.innerWidth,Vt.innerHeight]:[void 0,void 0]}function E(e,n){var a;return t.isFunction(e)?e:t.isString(e)?(a=n.scales[e])&&a.value:void 0}function O(e,t,n){var a=Wt+n;if(!t.hasOwnProperty(a))try{t[a]=e.scaleRef(n)}catch(e){}}function D(e,t,n,a){if(t[0].type===Mt)O(n,a,t[0].value);else if(t[0].type===At)for(e in n.scales)O(n,a,e)}function F(e,t){var n=E(e,(t||this).context);return n&&n.range?n.range():[]}function V(e,t){var n=E(e,(t||this).context);return n?n.domain():[]}function j(e,t){var n=E(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}function M(e,t,n){return l.bandSpace(e||0,t||0,n||0)}function A(e,t){var n=E(e,(t||this).context);return n?n.copy():void 0}function C(e,t,n){var a=E(e,(n||this).context);return a?a(t):void 0}function W(e,n,a){var r=E(e,(a||this).context);return r?t.isArray(n)?(r.invertRange||r.invert)(n):(r.invert||r.invertExtent)(n):void 0}function L(e){return function(t,n,a){var r=E(t,(a||this).context);return r&&r.path[e](n)}}function q(e){var t=this.context.data[e];return t?t.values.value:[]}function U(e,n,a,r){n[0].type!==Mt&&t.error("First argument to data functions must be a string literal.");var i=n[0].value,o=Lt+i;r.hasOwnProperty(o)||(r[o]=a.getData(i).tuplesRef())}function B(e,t,n){var a=this.context.data[e]["index:"+t],r=a?a.value.get(n):void 0;return r?r.count:r}function T(e,n,a,r){n[0].type!==Mt&&t.error("First argument to indata must be a string literal."),n[1].type!==Mt&&t.error("Second argument to indata must be a string literal.");var i=n[0].value,o=n[1].value,l=Ct+o;r.hasOwnProperty(l)||(r[l]=a.getData(i).indataRef(a,o))}function I(e){return e.data}function X(e,t){var n=q.call(t,e);return n.root&&n.root.lookup||It}function Y(e,t,n){var a=X(e,this),r=a[t],i=a[n];return r&&i?r.path(i).map(I):void 0}function H(e,t){var n=X(e,this)[t];return n?n.ancestors().map(I):void 0}function N(e){return function(t){for(var n in e)if("_id"!==n&&t[n]!==e[n])return!1;return!0}}function G(e,n){for(var a=n.fields,r=n.values,i=n.getter||(n.getter=[]),o=a.length,l=0;l<o;++l)if(i[l]=i[l]||t.field(a[l]),i[l](e)!==r[l])return!1;return!0}function J(e,n){for(var a,r=n.intervals,i=r.length,o=0;o<i;++o){if(a=r[o].getter||(r[o].getter=t.field(r[o].field)),r[o].extent[0]===r[o].extent[1])return!0;if(!Xt(a(e),r[o].extent))return!1}return!0}function K(e,t,n,a,r,i){for(var o,l,s=this.context.data[e],u=s?s.values.value:[],d=a!==Nt,c=u.length,f=0;f<c;++f)if(o=u[f],l=t===o.unit,!(r===Jt&&l||r===Gt&&!l)&&(l=i(n,o),d^l))return l;return!c||d}function Q(e,t,n,a,r){return K.call(this,e,t,n,a,r,G)}function Z(e,t,n,a,r){return K.call(this,e,t,n,a,r,J)}function ee(e,t,n){return 1===arguments.length?Kt[e]:(Kt[e]=t,n&&(tn[e]=n),an&&(an.functions[e]=en+e),this)}function te(e){var t=n.functions(e);Qt.forEach(function(e){t[e]=Zt+e});for(var a in Kt)t[a]=en+a;return t}function ne(e){return e===sn?ln:e||ln}function ae(e,n){var a=e.merge?re:e.stream?ie:e.type?oe:t.error("Invalid stream specification: "+t.stringValue(e));return a(e,n)}function re(e,t){var n=e.merge.map(function(e){return ae(e,t)}),a=le({merge:n},e,t);return t.addStream(a).id}function ie(e,t){var n=ae(e.stream,t),a=le({stream:n},e,t);return t.addStream(a).id}function oe(e,t){var n=t.event(ne(e.source),e.type),a=le({stream:n},e,t);return 1===Object.keys(a).length?n:t.addStream(a).id}function le(e,n,a){var r=n.between;return r&&(2!==r.length&&t.error('Stream "between" parameter must have 2 entries: '+t.stringValue(n)),e.between=[ae(r[0],a),ae(r[1],a)]),r=n.filter?t.array(n.filter):[],(n.marktype||n.markname||n.markrole)&&r.push(se(n.marktype,n.markname,n.markrole)),n.source===sn&&r.push("inScope(event.item)"),r.length&&(e.filter=on("("+r.join(")&&(")+")").$expr),null!=(r=n.throttle)&&(e.throttle=+r),null!=(r=n.debounce)&&(e.debounce=+r),n.consume&&(e.consume=!0),e}function se(e,t,n){var a="event.item";return a+(e&&"*"!==e?"&&"+a+".mark.marktype==='"+e+"'":"")+(n?"&&"+a+".mark.role==='"+n+"'":"")+(t?"&&"+a+".mark.name==='"+t+"'":"")}function ue(e,n){return t.isArray(e)?e.map(function(e){return ue(e,n)}):t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported parameter object: "+t.stringValue(e)):e}function de(e,n,a,r){var i,o,l;if(e.signal)i="datum",l=yn(e.signal,n,a,r);else if(e.group||e.parent){for(o=Math.max(1,e.level||1),i="item";o-- >0;)i+=".mark.group";e.parent?(l=e.parent,i+=".datum"):l=e.group}else e.datum?(i="datum",l=e.datum):t.error("Invalid field reference: "+t.stringValue(e));return e.signal||(t.isString(l)?(r[l]=1,l=t.splitAccessPath(l).map(t.stringValue).join("][")):l=de(l,n,a,r)),i+"["+l+"]"}function ce(e,n){if(!t.isString(e))return-1;var a=n.scaleType(e);return"band"===a||"point"===a?1:0}function fe(e,n,a,r){var i;if(t.isString(e))i=Wt+e,a.hasOwnProperty(i)||(a[i]=n.scaleRef(e)),i=t.stringValue(i);else{for(i in n.scales)a[Wt+i]=n.scaleRef(i);i=t.stringValue(Wt)+"+"+(e.signal?"("+yn(e.signal,n,a,r)+")":xn(e,n,a,r))}return"_["+i+"]"}function pe(e,n,a,r){var i,o,l,s={},u="var o=item,datum=o.datum,$;";for(i in e)o=e[i],t.isArray(o)?u+=zn(i,o,r,a,s):(l=Rn(i,o,r,a,s),u+=wn("o",i,l));return u+=mn(e,n),u+="return 1;",{$expr:u,$fields:Object.keys(s),$output:Object.keys(e)}}function ge(e){return t.isObject(e)?e:{value:e}}function he(e,t,n){return null!=n?(e[t]={value:n},1):0}function me(e,n,a){for(var r in n)a&&a.hasOwnProperty(r)||(e[r]=t.extend(e[r]||{},n[r]));return e}function ve(e,t,n,a,r){var i,o;r=r||{},r.encoders={$encode:i={}},e=ye(e,t,n,a.config);for(o in e)i[o]=pe(e[o],t,r,a);return r}function ye(e,n,a,r){var i,o,l;"legend"!=a&&0!==String(a).indexOf("axis")||(a=null),r=a===$n?r.group:a===Pn||r[n=a]?t.extend({},r.mark,r[n]):{},i={};for(o in r)l=xe(o,e)||("fill"===o||"stroke"===o)&&(xe("fill",e)||xe("stroke",e)),l||(i[o]={value:r[o]});return e=t.extend({},e),e.enter=t.extend(i,e.enter),e}function xe(e,t){return t.enter&&t.enter[e]||t.update&&t.update[e]}function be(e,t,n,a){this.id=-1,this.type=e,this.value=t,this.params=n,a&&(this.parent=a)}function ke(e,t,n,a){return new be(e,t,n,a)}function Se(e,t){return ke("Operator",e,t)}function Re(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function we(e,t){return t?{$field:e,$name:t}:{$field:e}}function ze(e,t){return{$compare:e,$order:t}}function Pe(e){return{$key:e}}function $e(e){return t.isObject(e)?(e.order===ya?"-":"+")+_e(e.op,e.field):""}function _e(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}function Ee(e){return e&&e.signal}function Oe(e){return function(t,n,a){return ke(e,n,t||void 0,a)}}function De(e,t,n){var a,r,i,o={};for(r=0,i=e.params.length;r<i;++r)a=e.params[r],o[a.name]=Fe(a,t,n);return o}function Fe(e,n,a){var r,i=e.type;return"index"===i?je(e,n,a):"param"===i?Me(e,n,a):"projection"===i?a.projectionRef(n[e.name]):(r=n[e.name],void 0===r?void(e.required&&t.error("Missing required "+t.stringValue(n.type)+" parameter: "+t.stringValue(e.name))):e.array&&!Ee(r)?r.map(function(t){return Ve(e,t,a)}):Ve(e,r,a))}function Ve(e,n,a){var r=e.type;if(Ee(n))return qe(r)?t.error("Expression references can not be signals."):Ue(r)?a.fieldRef(n):Be(r)?a.compareRef(n):a.signalRef(n.signal);var i=e.expr||Ue(r);return i&&Ce(n)?on(n.expr,a):i&&We(n)?we(n.field):qe(r)?on(n,a):Le(r)?Re(a.getData(n).values):Ue(r)?we(n):Be(r)?a.compareRef(n):n}function je(e,n,a){return t.isString(n.from)||t.error('Lookup "from" parameter must be a string literal.'),a.getData(n.from).lookupRef(a,n.key)}function Me(e,n,a){var r=n[e.name];return e.array?(t.isArray(r)||t.error("Expected an array of sub-parameters. Instead: "+t.stringValue(r)),r.map(function(t){return Ae(e,t,a)})):Ae(e,r,a)}function Ae(e,n,a){var r,i,o,l,s;for(l=0,s=e.params.length;l<s;++l){i=e.params[l];for(o in i.key)if(i.key[o]!==n[o]){i=null;break}if(i)break}return i||t.error("Unsupported parameter: "+t.stringValue(n)),r=t.extend(De(i,n,a),i.key),Re(a.add(Va(r)))}function Ce(e){return e&&e.expr}function We(e){return e&&e.field}function Le(e){return"data"===e}function qe(e){return"expr"===e}function Ue(e){return"field"===e}function Be(e){return"compare"===e}function Te(e,t,n,a,r){this.scope=e,this.input=t,this.output=n,this.values=a,this.aggregate=r,this.index={}}function Ie(e){return t.isString(e)?e:null}function Xe(e,t,n){var a,r=_e(n.op,n.field);if(t.ops){for(var i=0,o=t.as.length;i<o;++i)if(t.as[i]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((a=n.op.signal)?e.signalRef(a):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function Ye(e,t,n,a,r,i,o){var l,s,u=t[n]||(t[n]={}),d=$e(i),c=Ie(r);if(null!=c&&(e=t.scope,c+=d?"|"+d:"",l=u[c]),!l){var f=i?{field:ma,pulse:t.countsRef(e,r,i)}:{field:e.fieldRef(r),pulse:Re(t.output)};d&&(f.sort=e.sortRef(i)),s=e.add(ke(a,void 0,f)),o&&(t.index[r]=s),l=Re(s),null!=c&&(u[c]=l)}return l}function He(e,t){return null!=e?e:t}function Ne(e,t,n){var a,r=+t.symbolSize;return a=n&&n.update&&n.update.fontSize,a||(a=n&&n.enter&&n.enter.fontSize),a&&(a=a.value),a||(a=+t.labelFontSize),e.size?{$expr:"Math.max(Math.ceil(Math.sqrt(_.scale(datum))),"+a+")"}:Math.max(Math.ceil(Math.sqrt(r)),a)}function Ge(e){var t={},n=he(t,"fill",e.fillColor)+he(t,"stroke",e.strokeColor)+he(t,"strokeWidth",e.strokeWidth)+he(t,"strokeDash",e.strokeDash)+he(t,"cornerRadius",e.cornerRadius);return n?t:void 0}function Je(e){return er.hasOwnProperty(e)}function Ke(e){return"quantile"===e}function Qe(e,n){return t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported object: "+t.stringValue(e)):e}function Ze(e,t){return e.signal?t.signalRef(e.signal):e.map(function(e){return Qe(e,t)})}function et(e){t.error("Can not find data set: "+t.stringValue(e))}function tt(e,n,a){return e?e.signal?a.signalRef(e.signal):(t.isArray(e)?nt:e.fields?rt:at)(e,n,a):void(null==n.domainMin&&null==n.domainMax||t.error("No scale domain defined for domainMin/domainMax to override."))}function nt(e,t,n){return e.map(function(e){return Qe(e,n)})}function at(e,t,n){var a=n.getData(e.data);return a||et(e.data),Je(t.type)?a.valuesRef(n,e.field,lt(e.sort,!1)):Ke(t.type)?a.domainRef(n,e.field):a.extentRef(n,e.field)}function rt(e,n,a){var r=e.data,i=e.fields.reduce(function(e,n){return n=t.isString(n)?{data:r,field:n}:t.isArray(n)||n.signal?it(n,a):n,e.push(n),e},[]);return(Je(n.type)?ot:Ke(n.type)?st:ut)(e,a,i)}function it(e,n){var a="_:vega:_"+Ka++,r=Sa({});return t.isArray(e)?r.value={$ingest:e}:e.signal&&n.signalRef("modify("+t.stringValue(a)+","+e.signal+", true)"),n.addDataPipeline(a,[r,qa({})]),{data:a,field:"data"}}function ot(e,t,n){var a,r,i,o;return a=n.map(function(e){var n=t.getData(e.data);return n||et(e.data),n.countsRef(t,e.field)}),r=t.add(xa({groupby:ma,ops:["sum"],fields:[t.fieldRef("count")],as:["count"],pulse:a})),i=t.add(Sa({pulse:Re(r)})),o=t.add(Ba({field:ma,sort:t.sortRef(lt(e.sort,!0)),pulse:Re(i)})),Re(o)}function lt(e,n){return e&&(e.field||e.op?e.field||"count"===e.op?n&&e.field?t.error("Multiple domain scales can not sort by field."):n&&e.op&&"count"!==e.op&&t.error("Multiple domain scales support op count only."):t.error("No field provided for sort aggregate op: "+e.op):t.isObject(e)?e.field="key":e={field:"key"}),e}function st(e,t,n){var a=n.map(function(e){var n=t.getData(e.data);return n||et(e.data),n.domainRef(t,e.field)});return Re(t.add(Fa({values:a})))}function ut(e,t,n){var a=n.map(function(e){var n=t.getData(e.data);return n||et(e.data),n.extentRef(t,e.field)});return Re(t.add(Da({extents:a})))}function dt(e,t){t.interpolate=Qe(e.type||e),null!=e.gamma&&(t.interpolateGamma=Qe(e.gamma))}function ct(e,n,a){var r=e.range,i=n.config.range;if(r.signal)return n.signalRef(r.signal);if(t.isString(r)){if(i&&i.hasOwnProperty(r))return e=t.extend({},e,{range:i[r]}),ct(e,n,a);"width"===r?r=[0,{signal:"width"}]:"height"===r?r=Je(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t.error("Unrecognized scale range value: "+t.stringValue(r))}else{if(r.scheme)return a.scheme=Qe(r.scheme,n),r.extent&&(a.schemeExtent=Ze(r.extent,n)),void(r.count&&(a.schemeCount=Qe(r.count,n)));if(r.step)return void(a.rangeStep=Qe(r.step,n));if(Je(e.type)&&!t.isArray(r))return tt(r,e,n);t.isArray(r)||t.error("Unsupported range type: "+t.stringValue(r))}return r.map(function(e){return Qe(e,n)})}function ft(e,t){var n=[];e.transform&&e.transform.forEach(function(e){n.push(Ta(e,t))}),e.on&&e.on.forEach(function(n){Na(n,t,e.name)}),t.addDataPipeline(e.name,pt(e,t,n))}function pt(e,t,n){var a,r,i,o,l,s=[],u=null,d=!1,c=!1;for(e.values?s.push(u=gt({$ingest:e.values,$format:e.format})):e.url?s.push(u=gt({$request:e.url,$format:e.format})):e.source&&(a=t.getData(e.source),u=a.output,s.push(null)),r=0,i=n.length;r<i;++r)o=n[r],l=o.metadata,u||l.source||s.push(u=gt()),s.push(o),l.generates&&(c=!0),l.modifies&&!c&&(d=!0),l.source?u=o:l.changes&&(u=null);return a&&(s[0]=Ca({derive:d,pulse:Re(a.output)}),d&&s.splice(1,0,gt())),u||s.push(gt()),s.push(qa({})),s}function gt(e){var t=Sa({},e);return t.metadata={source:!0},t}function ht(e,t){return{scale:e.scale,range:t}}function mt(e,n){var a,r,i,o,l,s=n.config;return n.background=e.background||s.background,l=Re(n.root=n.add(Se())),n.addSignal("width",e.width||-1),n.addSignal("height",e.height||-1),n.addSignal("padding",kt(e.padding,s)),t.array(e.signals).forEach(function(e){dr[e.name]||wt(e,n)}),r=n.add(Sa()),i=me({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),i=n.add(za(ve(i,Tn,$n,n,{pulse:Re(r)}))),o=n.add(Ua({legendMargin:s.legendMargin,autosize:bt(e.autosize,s),mark:l,pulse:Re(i)})),n.pushState(Re(i),Re(o),null),ur(e,n,!0),a=n.add(ka({mark:l,pulse:Re(o)})),a=n.add(Wa({pulse:Re(a)})),a=n.add(qa({pulse:Re(a)})),n.addData("root",new Te(n,r,r,a)),n}function vt(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.background=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function yt(e){this.config=e.config,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function xt(){return{padding:0,autosize:"pad",background:null,group:null,mark:null,arc:{fill:hr},area:{fill:hr},image:null,line:{stroke:hr,strokeWidth:gr},path:{stroke:hr},rect:{fill:hr},rule:{stroke:mr},shape:{stroke:hr},symbol:{fill:hr,size:64},text:{fill:mr,font:"sans-serif",fontSize:11},point:{size:pr,strokeWidth:gr,shape:"circle"},circle:{size:pr,strokeWidth:gr},square:{size:pr,strokeWidth:gr},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:mr,grid:!1,gridWidth:1,gridColor:yr,gridDash:[],gridOpacity:1,labels:!0,labelAngle:0,labelColor:mr,labelFont:"sans-serif",labelFontSize:10,labelPadding:2,labelLimit:180,ticks:!0,tickRound:!0,tickSize:5,tickWidth:1,tickColor:mr,titleAlign:"center",titlePadding:2,titleColor:mr,titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},legend:{orient:"right",offset:18,padding:0,entryPadding:5,titlePadding:5,gradientWidth:100,gradientHeight:20,gradientStrokeColor:yr,gradientStrokeWidth:0,gradientLabelBaseline:"top",gradientLabelOffset:2,labelColor:mr,labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,labelLimit:160,symbolType:"circle",symbolSize:100,symbolColor:vr,symbolStrokeWidth:1.5,titleColor:mr,titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleAlign:"left",titleBaseline:"top",titleLimit:180},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues",extent:[.2,1]},heatmap:{scheme:"viridis"},ramp:{scheme:"blues",extent:[.2,1]},diverging:{scheme:"blueorange"},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}var bt=function(e,n){return e=e||n.autosize,t.isObject(e)?e:(e=e||"pad",{type:e})},kt=function(e,n){return e=e||n.padding,t.isObject(e)?e:(e=+e||0,{top:e,bottom:e,left:e,right:e})},St="outer",Rt=["value","update","react","bind"],wt=function(e,t){var n=e.name;if(e.push===St)t.signals[n]||c("No prior signal definition",n),Rt.forEach(function(t){void 0!==e[t]&&c("Invalid property ",t)});else{var a=t.addSignal(n,e.value);e.react===!1&&(a.react=!1),e.bind&&t.addBinding(n,e.bind)}},zt=f(i.format),Pt=f(o.utcFormat),$t=f(o.timeFormat),_t=f(o.utcParse),Et=f(o.timeParse),Ot=new Date(2e3,0,1),Dt=function(e){var t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},Ft=function(e,t,n){var a,r=e[0],i=e[1];return i<r&&(a=i,i=r,r=a),a=i-r,a>=n-t?[t,n]:[Math.min(Math.max(r,t),n-a),Math.min(Math.max(i,a),n)]},Vt="undefined"!=typeof window&&window||null,jt=function(e){return e[e.length-1]-e[0]||0},Mt="Literal",At="Identifier",Ct="@",Wt="%",Lt=":",qt=function(e,t,n,a){var r=s.Gradient(t,n),i=e.domain(),o=i[0],u=i[i.length-1],d=l.scaleFraction(e,o,u);e.ticks&&(i=e.ticks(+a||15),o!==i[0]&&i.unshift(o),u!==i[i.length-1]&&i.push(u));for(var c=0,f=i.length;c<f;++c)r.stop(d(i[c]),e(i[c]));return r},Ut=L("area"),Bt=L("bounds"),Tt=L("centroid"),It={},Xt=function(e,t){var n,a=t[0],r=t[t.length-1];return a>r&&(n=a,a=r,r=n),a<=e&&e<=r},Yt=function(e,t,n){if(e){var a=this.context.dataflow,r=e.mark.source;a.pulse(r,a.changeset().encode(e,t))}return void 0!==n?n:e},Ht=function(e,n,a,r,i,o){var l,s,u=this.context.dataflow,d=this.context.data[e],c=d.input,f=d.changes,p=u.stamp();if(u._trigger===!1||!(c.value.length||n||r))return 0;if((!f||f.stamp<p)&&(d.changes=f=u.changeset(),f.stamp=p,u.runAfter(function(){d.modified=!0,u.pulse(c,f).run()})),a&&(l=a===!0?t.truthy:t.isArray(a)||null!=a._id?a:N(a),f.remove(l)),n&&f.insert(n),r&&(l=N(r),c.value.some(l)?f.remove(l):f.insert(r)),i)for(s in o)f.modify(i,s,o[s]);return 1},Nt="union",Gt="unit",Jt="others",Kt={pad:t.pad,truncate:t.truncate,rgb:a.rgb,lab:a.lab,hcl:a.hcl,hsl:a.hsl,sequence:r.range,format:zt,utcFormat:Pt,utcParse:_t,timeFormat:$t,timeParse:Et,monthFormat:g,monthAbbrevFormat:h,dayFormat:m,dayAbbrevFormat:v,quarter:y,utcquarter:x,warn:k,info:S,debug:R,inScope:Dt,clampRange:Ft,pinchDistance:w,pinchAngle:z,open:P,screen:$,windowsize:_,span:jt,bandspace:M,inrange:Xt,encode:Yt,modify:Ht},Qt=["view","item","group","xy","x","y"],Zt="event.vega.",en="this.",tn={};ee("bandwidth",j,D),ee("copy",A,D),ee("domain",V,D),ee("range",F,D),ee("invert",W,D),ee("scale",C,D),ee("gradient",qt,D),ee("geoArea",Ut,D),ee("geoBounds",Bt,D),ee("geoCentroid",Tt,D),ee("indata",B,T),ee("data",q,U),ee("vlPoint",Q,U),ee("vlInterval",Z,U),ee("treePath",Y,U),ee("treeAncestors",H,U);var nn={blacklist:["_"],whitelist:["datum","event"],fieldvar:"datum",globalvar:function(e){return"_["+t.stringValue("$"+e)+"]"},functions:te,constants:n.constants,visitors:tn},an=n.codegen(nn),rn="$",on=function(e,a,r){var i,o,l={};try{i=n.parse(e)}catch(n){t.error("Expression parse error: "+t.stringValue(e))}return i.visit(function(e){if("CallExpression"===e.type){var t=e.callee.name,n=nn.visitors[t];n&&n(t,e.arguments,a,l)}}),o=an(i),o.globals.forEach(function(e){var t=rn+e;!l.hasOwnProperty(t)&&a.getSignal(e)&&(l[t]=a.signalRef(e))}),{$expr:r?r+"return("+o.code+");":o.code,$fields:o.fields,$params:l}},ln="view",sn="scope",un=function(e,t){return e.signal?t.getSignal(e.signal).id:ae(e,t)},dn="var datum=event.item&&event.item.datum;",cn=function(e,n,a){var r,i=e.events,o=e.update,l=e.encode,s=[],d="";i||t.error("Signal update missing events specification."),t.isString(i)&&(i=u.selector(i)),i=t.array(i).filter(function(e){return e.signal?(s.push(e),0):1}),i.length&&s.push(i.length>1?{merge:i}:i[0]),null!=l&&(o&&t.error("Signal encode and update are mutually exclusive."),o="encode(item(),"+t.stringValue(l)+")"),d=t.isString(o)?on(o,n,dn):null!=o.expr?on(o.expr,n,dn):null!=o.value?o.value:null!=o.signal?{$expr:"_.value",$params:{value:n.signalRef(o.signal)}}:t.error("Invalid signal update specification."),r={target:a,update:d},e.force&&(r.options={force:!0}),s.forEach(function(e){e={source:un(e,n)},n.addUpdate(t.extend(e,r))})},fn=function(e,t){var n=t.getSignal(e.name);if(e.update){var a=on(e.update,t);n.update=a.$expr,n.params=a.$params}e.on&&e.on.forEach(function(e){cn(e,t,n.id)})},pn=function(e,t){var n={};for(var a in e)"name"!==a&&(n[a]=ue(e[a],t));t.addProjection(e.name,n)},gn=t.toSet(["rule"]),hn=t.toSet(["group","image","rect"]),mn=function(e,t){var n="";return gn[t]?n:(e.x2&&(e.x?(hn[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+=e.width?"o.x=o.x2-o.width;":"o.x=o.x2;"),e.xc&&(n+=e.width?"o.x=o.xc-o.width/2;":"o.x=o.xc;"),e.y2&&(e.y?(hn[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+=e.height?"o.y=o.y2-o.height;":"o.y=o.y2;"),e.yc&&(n+=e.height?"o.y=o.yc-o.height/2;":"o.y=o.yc;"),n)},vn=function(e,t,n,a){function r(e,r,i,o){var l=Rn(null,r,t,n,a),s=Rn(null,i,t,n,a),u=Rn(null,o,t,n,a);return"this."+e+"("+[l,s,u].join(",")+").toString()"}return e.c?r("hcl",e.h,e.c,e.l):e.h||e.s?r("hsl",e.h,e.s,e.l):e.l||e.a?r("lab",e.l,e.a,e.b):e.r||e.g||e.b?r("rgb",e.r,e.g,e.b):null},yn=function(e,n,a,r){var i=on(e,n);return i.$fields.forEach(function(e){r[e]=1}),t.extend(a,i.$params),i.$expr},xn=function(e,n,a,r){return de(t.isObject(e)?e:{datum:e},n,a,r)},bn=function(e,t,n,a,r){var i,o,l,s=fe(e.scale,n,a,r);return null!=e.range?(i=+e.range,o=s+".range()",t=0===i?o+"[0]":"($="+o+","+(1===i?"$[$.length-1]":"$[0]+"+i+"*($[$.length-1]-$[0])")+")"):(void 0!==t&&(t=s+"("+t+")"),e.band&&(l=ce(e.scale,n))&&(o=s+".bandwidth",i=+e.band,i=o+"()"+(1===i?"":"*"+i),l<0&&(i="("+o+"?"+i+":0)"),t=(t?t+"+":"")+i,e.extra&&(t="(datum.extra?"+s+"(datum.extra.value):"+t+")")),null==t&&(t="0")),t},kn=function(e,n,a,r){return"this.gradient("+fe(e.gradient,n,a,r)+","+t.stringValue(e.start)+","+t.stringValue(e.stop)+","+t.stringValue(e.count)+")"},Sn=function(e,n,a,r){return t.isObject(e)?"("+Rn(null,e,n,a,r)+")":e},Rn=function(e,n,a,r,i){if(null!=n.gradient)return kn(n,a,r,i);var o=n.signal?yn(n.signal,a,r,i):n.color?vn(n.color,a,r,i):null!=n.field?xn(n.field,a,r,i):void 0!==n.value?t.stringValue(n.value):void 0;return null!=n.scale&&(o=bn(n,o,a,r,i)),void 0===o&&(o=null),null!=n.exponent&&(o="Math.pow("+o+","+Sn(n.exponent,a,r,i)+")"),null!=n.mult&&(o+="*"+Sn(n.mult,a,r,i)),null!=n.offset&&(o+="+"+Sn(n.offset,a,r,i)),n.round&&(o="Math.round("+o+")"),o},wn=function(e,n,a){return e+"["+t.stringValue(n)+"]="+a+";"},zn=function(e,t,n,a,r){var i="";return t.forEach(function(t){var o=Rn(e,t,n,a,r);i+=t.test?yn(t.test,n,a,r)+"?"+o+":":o}),wn("o",e,i)},Pn="mark",$n="frame",_n="scope",En="axis",On="axis-domain",Dn="axis-grid",Fn="axis-label",Vn="axis-tick",jn="axis-title",Mn="legend",An="legend-entry",Cn="legend-gradient",Wn="legend-label",Ln="legend-symbol",qn="legend-title",Un={name:1,interactive:1},Bn=function(e,t,n,a,r,i){return{type:e,name:i?i.name:void 0,role:t,key:n,from:a,interactive:!(!i||!i.interactive),encode:me(r,i,Un)}},Tn="group",In="rect",Xn="rule",Yn="symbol",Hn="text",Nn=function(e,t,n){var a,r,i={value:0},o={};return o.enter=a={opacity:i,x:i,y:i},he(a,"width",t.gradientWidth),he(a,"height",t.gradientHeight),he(a,"stroke",t.gradientStrokeColor),he(a,"strokeWidth",t.gradientStrokeWidth),o.exit={opacity:i},o.update=r={x:i,y:i,fill:{gradient:e},opacity:{value:1}},he(r,"width",t.gradientWidth),he(r,"height",t.gradientHeight),Bn(In,Cn,void 0,void 0,o,n)},Gn="top",Jn="left",Kn="right",Qn="bottom",Zn="index",ea="label",ta="offset",na="perc",aa="size",ra="total",ia="value",oa=["shape","size","fill","stroke","strokeDash","opacity"],la="datum."+na+'<=0?"left":datum.'+na+'>=1?"right":"center"',sa=function(e,t,n,a){var r,i,o={value:0},l={};return l.enter=r={opacity:o,text:{field:ea}},he(r,"fill",t.labelColor),he(r,"font",t.labelFont),he(r,"fontSize",t.labelFontSize),he(r,"baseline",t.gradientLabelBaseline),he(r,"limit",t.gradientLabelLimit),l.exit={opacity:o},l.update=i={opacity:{value:1}},r.x=i.x={field:na,mult:t.gradientWidth},r.y=i.y={value:t.gradientHeight,offset:t.gradientLabelOffset},r.align=i.align={signal:la},Bn(Hn,Wn,na,a,l,n)},ua=function(e,t,n,a){var r,i,o={value:0},l={};return l.enter=r={opacity:o,text:{field:ea}},he(r,"align",t.labelAlign),he(r,"baseline",t.labelBaseline),he(r,"fill",t.labelColor),he(r,"font",t.labelFont),he(r,"fontSize",t.labelFontSize),he(r,"limit",t.labelLimit),l.exit={opacity:o},l.update=i={opacity:{value:1}},r.x=i.x={field:ta,offset:t.labelOffset},r.y=i.y={field:aa,mult:.5,offset:{field:ra,offset:{field:{group:"entryPadding"},mult:{field:Zn}}}},Bn(Hn,Wn,ia,a,l,n)},da=function(e,t,n,a){var r,i,o={value:0},l={};return l.enter=r={opacity:o},he(r,"shape",t.symbolType),he(r,"size",t.symbolSize),he(r,"strokeWidth",t.symbolStrokeWidth),e.fill||he(r,"stroke",t.symbolColor),l.exit={opacity:o},l.update=i={opacity:{value:1}},r.x=i.x={field:ta,mult:.5},r.y=i.y={field:aa,mult:.5,offset:{field:ra,offset:{field:{group:"entryPadding"},mult:{field:Zn}}}},oa.forEach(function(t){e[t]&&(i[t]=r[t]={scale:e[t],field:ia})}),Bn(Yn,Ln,ia,a,l,n)},ca=function(e,t,n,a){var r,i={value:0},o=e.title,l={};return l.enter=r={x:{field:{group:"padding"}},y:{field:{group:"padding"}},opacity:i},he(r,"align",t.titleAlign),he(r,"baseline",t.titleBaseline),he(r,"fill",t.titleColor),he(r,"font",t.titleFont),he(r,"fontSize",t.titleFontSize),he(r,"fontWeight",t.titleFontWeight),he(r,"limit",t.titleLimit),l.exit={opacity:i},l.update={opacity:{value:1},text:o&&o.signal?{signal:o.signal}:{value:o+""}},Bn(Hn,qn,null,a,l,n)},fa=function(e,t,n,a,r,i){return{type:Tn,name:t,role:e,from:n,interactive:a,encode:r,marks:i}},pa=function(e){return e.role||(e.type===Tn&&(e.legends||e.axes)?_n:Pn)},ga=function(e){return{clip:e.clip||!1,interactive:e.interactive!==!1,marktype:e.type,name:e.name||void 0,role:pa(e),zindex:+e.zindex||void 0}},ha=function(e){return e},ma=we("key"),va="ascending",ya="descending",xa=Oe("Aggregate"),ba=Oe("AxisTicks"),ka=Oe("Bound"),Sa=Oe("Collect"),Ra=Oe("Compare"),wa=Oe("DataJoin"),za=Oe("Encode"),Pa=Oe("Facet"),$a=Oe("Field"),_a=Oe("Key"),Ea=Oe("LegendEntries"),Oa=Oe("Mark"),Da=Oe("MultiExtent"),Fa=Oe("MultiValues"),Va=Oe("Params"),ja=Oe("PreFacet"),Ma=Oe("Projection"),Aa=Oe("Proxy"),Ca=Oe("Relay"),Wa=Oe("Render"),La=Oe("Scale"),qa=Oe("Sieve"),Ua=Oe("ViewLayout"),Ba=Oe("Values"),Ta=function(e,n){var a=d.definition(e.type);a||t.error("Unrecognized transform type: "+t.stringValue(e.type));var r=ke(a.type,null,De(a,e,n));return e.signal&&n.addSignal(e.signal,n.proxy(r)),r.metadata=a.metadata||{},r},Ia=function(e,n,a){var r,i,o,l,s;return e?(r=e.facet)&&(n||t.error("Only group marks can be faceted."),null!=r.field?l=s=Re(a.getData(r.data).output):(i=a.keyRef(r.groupby),e.data?s=Re(a.getData(e.data).aggregate):(o=Ta(t.extend({type:"aggregate",groupby:t.array(r.groupby)},r.aggregate)),o.params.key=i,o.params.pulse=Re(a.getData(r.data).output),l=s=Re(a.add(o))))):l=Re(a.add(Sa(null,[{}]))),l||(l=e.$ref?e:Re(e.mark?a.getData(ha(e.mark)).output:a.getData(e.data).output)),{key:i,pulse:l,parent:s}};Te.fromEntries=function(e,t){var n=t.length,a=1,r=t[0],i=t[n-1],o=t[n-2],l=null;for(e.add(t[0]);a<n;++a)t[a].params.pulse=Re(t[a-1]),e.add(t[a]),"Aggregate"===t[a].type&&(l=t[a]);return new Te(e,r,o,i,l)};var Xa=Te.prototype;Xa.countsRef=function(e,t,n){var a,r,i,o=this,l=o.counts||(o.counts={}),s=Ie(t);return null!=s&&(e=o.scope,a=l[s]),a?n&&n.field&&Xe(e,a.agg.params,n):(i={groupby:e.fieldRef(t,"key"),pulse:Re(o.output)},n&&n.field&&Xe(e,i,n),r=e.add(xa(i)),a=e.add(Sa({pulse:Re(r)})),a={agg:r,ref:Re(a)},null!=s&&(l[s]=a)),a.ref},Xa.tuplesRef=function(){return Re(this.values)},Xa.extentRef=function(e,t){return Ye(e,this,"extent","Extent",t,!1)},Xa.domainRef=function(e,t){return Ye(e,this,"domain","Values",t,!1)},Xa.valuesRef=function(e,t,n){return Ye(e,this,"vals","Values",t,n||!0)},Xa.lookupRef=function(e,t){return Ye(e,this,"lookup","TupleIndex",t,!1)},Xa.indataRef=function(e,t){return Ye(e,this,"indata","TupleIndex",t,!0,!0)};var Ya=function(e,n,a){var r,i,o,l,s=e.from.facet,u=s.name,d=Re(n.getData(s.data).output);s.name||t.error("Facet must have a name: "+t.stringValue(s)),s.data||t.error("Facet must reference a data set: "+t.stringValue(s)),s.field?l=n.add(ja({field:n.fieldRef(s.field),pulse:d})):s.groupby?l=n.add(Pa({key:n.keyRef(s.groupby),group:Re(n.proxy(a.parent)),pulse:d})):t.error("Facet must specify groupby or field: "+t.stringValue(s)),r=n.fork(),i=r.add(Sa()),o=r.add(qa({pulse:Re(i)})),r.addData(u,new Te(r,i,i,o)),r.addSignal("parent",null),l.params.subflow={$subflow:ur(e,r).toRuntime()}},Ha=function(e,t,n){var a=t.add(ja({pulse:n.pulse})),r=t.fork();r.add(qa()),r.addSignal("parent",null),a.params.subflow={$subflow:ur(e,r).toRuntime()}},Na=function(e,t,n){var a,r,i=e.remove,o=e.insert,l=e.toggle,s=e.modify,u=e.values,d=t.add(Se());a="if("+e.trigger+',modify("'+n+'",'+[o,i,l,s,u].map(function(e){return null==e?"null":e}).join(",")+"),0)",r=on(a,t),d.update=r.$expr,d.params=r.$params},Ga=function(e,n){var a,r,i,o,l,s,u,d,c,f,p,g,h,m=pa(e),v=e.type===Tn,y=e.from&&e.from.facet,x=m===_n||m===$n,b=m===Pn||x||y;i=Ia(e.from,v,n),r=n.add(wa({key:i.key||(e.key?we(e.key):void 0),pulse:i.pulse,clean:!v})),c=Re(r),r=o=n.add(Sa({pulse:c})),r=n.add(Oa({markdef:ga(e),context:{$context:!0},groups:n.lookup(),parent:n.signals.parent?n.signalRef("parent"):null,index:n.markpath(),pulse:Re(r)})),f=Re(r),r=n.add(za(ve(e.encode,e.type,m,n,{pulse:f}))),r.params.parent=n.encode(),e.transform&&e.transform.forEach(function(e){var a=Ta(e,n);(a.metadata.generates||a.metadata.changes)&&t.error("Mark transforms should not generate new data."),a.params.pulse=Re(r),n.add(r=a)}),p=Re(r),(y||x)&&(x=n.add(Ua({legendMargin:n.config.legendMargin,mark:f,pulse:p})),g=Re(x)),l=n.add(ka({mark:f,pulse:g||p})),h=Re(l),v&&(b&&(a=n.operators,a.pop(),
x&&a.pop()),n.pushState(p,g||h,c),y?Ya(e,n,i):b?Ha(e,n,i):ur(e,n),n.popState(),b&&(x&&a.push(x),a.push(l))),s=n.add(Wa({pulse:h})),u=n.add(qa({pulse:h},void 0,n.parent())),null!=e.name&&(d=ha(e.name),n.addData(d,new Te(n,o,s,u)),e.on&&e.on.forEach(function(e){(e.insert||e.remove||e.toggle)&&t.error("Marks only support modify triggers."),Na(e,n,d)}))},Ja=function(e,n){var a,r,i,o,l,s,u,d,c=e.type||"symbol",f=n.config.legend,p=e.name||void 0,g=e.encode||{},h=!!e.interactive,m=e.size||e.shape||e.fill||e.stroke||e.strokeDash||e.opacity;return m||t.error("Missing valid scale for legend."),a={orient:He(e.orient,f.orient),title:null!=e.title},r=Re(n.add(Sa(null,[a]))),s=me({enter:Ge(f),update:{offset:ge(He(e.offset,f.offset)),padding:ge(He(e.padding,f.padding)),titlePadding:ge(He(e.titlePadding,f.titlePadding))}},g.legend),u={update:{x:{field:{group:"padding"}},y:{field:{group:"padding"}},entryPadding:ge(He(e.entryPadding,f.entryPadding))}},"gradient"===c?(i=Re(n.add(Ea({type:"gradient",scale:n.scaleRef(m),count:n.property(e.tickCount),values:n.property(e.values),formatSpecifier:n.property(e.format)}))),d=[Nn(m,f,g.gradient),sa(e,f,g.labels,i)]):(i=Re(n.add(Ea({size:Ne(e,f,g.labels),scale:n.scaleRef(m),count:n.property(e.tickCount),values:n.property(e.values),formatSpecifier:n.property(e.format)}))),d=[da(e,f,g.symbols,i),ua(e,f,g.labels,i)]),d=[fa(An,null,r,h,u,d)],a.title&&(l=ca(e,f,g.title,r),u.update.y.offset={field:{group:"titlePadding"},offset:l.encode.update.fontSize||l.encode.enter.fontSize},d.push(l)),o=fa(Mn,p,r,h,s,d),e.zindex&&(o.zindex=e.zindex),Ga(o,n)},Ka=0,Qa=["identity","ordinal","band","point","linear","pow","sqrt","log","sequential","time","utc","quantize","quantile","threshold","bin-linear","bin-ordinal"],Za=t.toSet(Qa),er=t.toSet(Qa.slice(1,4)),tr=function(e,n){var a,r,i=e.type||"linear";Za.hasOwnProperty(i)||t.error("Unrecognized scale type: "+t.stringValue(i)),a={type:i,domain:tt(e.domain,e,n)},null!=e.range&&(a.range=ct(e,n,a)),null!=e.interpolate&&dt(e.interpolate,a);for(r in e)a.hasOwnProperty(r)||"name"===r||(a[r]=Qe(e[r],n));n.addScale(e.name,a)},nr=function(e,n){var a=n.config,r=e.orient,i=r===Gn||r===Qn?a.axisX:a.axisY,o=a["axis"+r[0].toUpperCase()+r.slice(1)],l="band"===n.scaleType(e.scale)&&a.axisBand;return i||o||l?t.extend({},a.axis,i,o,l):a.axis},ar=function(e,t,n,a){var r,i,o,l,s,u=e.orient,d={value:0},c={};return c.enter=r={opacity:d},he(r,"stroke",t.tickColor),he(r,"strokeWidth",t.tickWidth),c.exit={opacity:d},c.update=i={opacity:{value:1}},u===Gn||u===Qn?(o="x",s="y"):(o="y",s="x"),l=o+"2",r[s]=d,i[o]=r[o]=ht(e,0),i[l]=r[l]=ht(e,1),Bn(Xn,On,null,a,c,n)},rr=function(e,t,n,a){var r,i,o,l,s,u,d,c,f=e.orient,p=e.gridScale,g=f===Jn||f===Gn?1:-1,h=g*e.offset||0,m={value:0},v={};return v.enter=r={opacity:m},he(r,"stroke",t.gridColor),he(r,"strokeWidth",t.gridWidth),he(r,"strokeDash",t.gridDash),v.exit=i={opacity:m},v.update=o={},he(o,"opacity",t.gridOpacity),l={scale:e.scale,field:ia,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra},f===Gn||f===Qn?(s="x",u="y",c="height"):(s="y",u="x",c="width"),d=u+"2",o[s]=r[s]=i[s]=l,p?(r[u]={scale:p,range:0,mult:g,offset:h},o[d]=r[d]={scale:p,range:1,mult:g,offset:h}):(r[u]={value:h},o[d]=r[d]={signal:c,mult:g,offset:h}),Bn(Xn,Dn,ia,a,v,n)},ir=function(e,t,n,a,r){var i,o,l,s,u,d=e.orient,c=d===Jn||d===Gn?-1:1,f={value:0},p={};return p.enter=i={opacity:f},he(i,"stroke",t.tickColor),he(i,"strokeWidth",t.tickWidth),p.exit=o={opacity:f},p.update=l={opacity:{value:1}},s=ge(r),s.mult=c,u={scale:e.scale,field:ia,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra},d===Gn||d===Qn?(l.y=i.y=f,l.y2=i.y2=s,l.x=i.x=o.x=u):(l.x=i.x=f,l.x2=i.x2=s,l.y=i.y=o.y=u),Bn(Xn,Vn,ia,a,p,n)},or=function(e,t,n,a,r){var i,o,l,s,u,d=e.orient,c=d===Jn||d===Gn?-1:1,f=null!=e.labelPadding?e.labelPadding:t.labelPadding,p={value:0},g={};return g.enter=i={opacity:p,text:{field:ea}},he(i,"angle",t.labelAngle),he(i,"fill",t.labelColor),he(i,"font",t.labelFont),he(i,"fontSize",t.labelFontSize),he(i,"limit",t.labelLimit),g.exit=o={opacity:p},g.update=l={opacity:{value:1}},s=ge(r),s.mult=c,s.offset=ge(f),s.offset.mult=c,u={scale:e.scale,field:ia,band:.5},d===Gn||d===Qn?(l.y=i.y=s,l.x=i.x=o.x=u,he(l,"align","center"),he(l,"baseline",d===Gn?"bottom":"top")):(l.x=i.x=s,l.y=i.y=o.y=u,he(l,"align",d===Kn?"left":"right"),he(l,"baseline","middle")),Bn(Hn,Fn,ia,a,g,n)},lr=function(e,t,n,a){var r,i,o,l=e.orient,s=e.title,u=l===Jn||l===Gn?-1:1,d=l===Gn||l===Qn,c={};return c.enter=r={opacity:{value:0}},he(r,"align",t.titleAlign),he(r,"fill",t.titleColor),he(r,"font",t.titleFont),he(r,"fontSize",t.titleFontSize),he(r,"fontWeight",t.titleFontWeight),he(r,"limit",t.titleLimit),c.exit={opacity:{value:0}},c.update=i={opacity:{value:1},text:s&&s.signal?{signal:s.signal}:{value:s+""}},o={scale:e.scale,range:.5},d?(i.x=o,i.angle={value:0},i.baseline={value:l===Gn?"bottom":"top"}):(i.y=o,i.angle={value:90*u},i.baseline={value:"bottom"}),he(i,"angle",t.titleAngle),he(i,"baseline",t.titleBaseline),!he(i,"x",t.titleX)&&d&&!xe(n,"x")&&(c.enter.auto={value:!0}),!he(i,"y",t.titleY)&&!d&&!xe(n,"y")&&(c.enter.auto={value:!0}),Bn(Hn,jn,null,a,c,n)},sr=function(e,t){var n,a,r,i,o,l,s,u=nr(e,t),d=e.name||void 0,c=e.encode||{},f=!!e.interactive;return n={orient:e.orient,ticks:null!=e.ticks?!!e.ticks:u.ticks,labels:null!=e.labels?!!e.labels:u.labels,grid:null!=e.grid?!!e.grid:u.grid,domain:null!=e.domain?!!e.domain:u.domain,title:null!=e.title},a=Re(t.add(Sa({},[n]))),l=me({update:{range:{signal:'abs(span(range("'+e.scale+'")))'},offset:ge(e.offset||0),position:ge(e.position||0),titlePadding:ge(e.titlePadding||u.titlePadding),minExtent:ge(e.minExtent||u.minExtent),maxExtent:ge(e.maxExtent||u.maxExtent)}},c.axis),r=Re(t.add(ba({scale:t.scaleRef(e.scale),extra:u.tickExtra,count:t.property(e.tickCount),values:t.property(e.values),formatSpecifier:t.property(e.format)}))),s=[],n.grid&&s.push(rr(e,u,c.grid,r)),n.ticks&&(i=null!=e.tickSize?e.tickSize:u.tickSize,s.push(ir(e,u,c.ticks,r,i))),n.labels&&(i=n.ticks?i:0,s.push(or(e,u,c.labels,r,i))),n.domain&&s.push(ar(e,u,c.domain,a)),n.title&&s.push(lr(e,u,c.title,a)),o=fa(En,d,a,f,l,s),e.zindex&&(o.zindex=e.zindex),Ga(o,t)},ur=function(e,n,a){var r=t.array(e.signals);return a||r.forEach(function(e){wt(e,n)}),t.array(e.projections).forEach(function(e){pn(e,n)}),t.array(e.data).forEach(function(e){ft(e,n)}),t.array(e.scales).forEach(function(e){tr(e,n)}),r.forEach(function(e){fn(e,n)}),n.parseLambdas(),t.array(e.axes).forEach(function(e){sr(e,n)}),t.array(e.marks).forEach(function(e){Ga(e,n)}),t.array(e.legends).forEach(function(e){Ja(e,n)}),n},dr=t.toSet(["width","height","padding"]),cr=vt.prototype=yt.prototype;cr.fork=function(){return new yt(this)},cr.toRuntime=function(){return this.finish(),{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings}},cr.id=function(){return(this._subid?this._subid+":":0)+this._id++},cr.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(function(t){t.$ref=e.id}),e.refs=null),e},cr.proxy=function(e){var t=e instanceof be?Re(e):e;return this.add(Aa({value:t}))},cr.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},cr.addUpdate=function(e){return this.updates.push(e),e},cr.finish=function(){function e(e,t,n){var a,r;e&&(a=e.data||(e.data={}),r=a[t]||(a[t]=[]),r.push(n))}var t,n;this.root&&(this.root.root=!0);for(t in this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;for(t in this.data){n=this.data[t],e(n.input,t,"input"),e(n.output,t,"output"),e(n.values,t,"values");for(var a in n.index)e(n.index[a],t,"index:"+a)}return this},cr.pushState=function(e,t,n){this._encode.push(Re(this.add(qa({pulse:e})))),this._parent.push(t),this._lookup.push(n?Re(this.proxy(n)):null),this._markpath.push(-1)},cr.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},cr.parent=function(){return t.peek(this._parent)},cr.encode=function(){return t.peek(this._encode)},cr.lookup=function(){return t.peek(this._lookup)},cr.markpath=function(){var e=this._markpath;return++e[e.length-1]},cr.fieldRef=function(e,n){if(t.isString(e))return we(e,n);e.signal||t.error("Unsupported field reference: "+t.stringValue(e));var a,r=e.signal,i=this.field[r];return i||(a={name:this.signalRef(r)},n&&(a.as=n),this.field[r]=i=Re(this.add($a(a)))),i},cr.compareRef=function(e){function n(e){return Ee(e)?(r=!0,Re(a[e.signal])):e}var a=this.signals,r=!1,i=t.array(e.field).map(n),o=t.array(e.order).map(n);return r?Re(this.add(Ra({fields:i,orders:o}))):ze(i,o)},cr.keyRef=function(e){function n(e){return Ee(e)?(r=!0,Re(a[e.signal])):e}var a=this.signals,r=!1;return e=t.array(e).map(n),r?Re(this.add(_a({fields:e}))):Pe(e)},cr.sortRef=function(e){if(!e)return e;var t=[_e(e.op,e.field),"_id"],n=e.order||va;return n.signal?Re(this.add(Ra({fields:t,orders:[n=this.signalRef(n.signal),n]}))):ze(t,[n,n])},cr.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var a=this.id();this.streams.push({id:a,source:e,type:t}),this.events[n]=a}return this.events[n]},cr.addSignal=function(e,n){this.signals.hasOwnProperty(e)&&t.error("Duplicate signal name: "+t.stringValue(e));var a=n instanceof be?n:this.add(Se(n));return this.signals[e]=a},cr.getSignal=function(e){return this.signals[e]||t.error("Unrecognized signal name: "+t.stringValue(e)),this.signals[e]},cr.signalRef=function(e){return this.signals[e]?Re(this.signals[e]):(this.lambdas[e]||(this.lambdas[e]=this.add(Se(null))),Re(this.lambdas[e]))},cr.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var a=e[t],r=on(a,this),i=this.lambdas[a];i.params=r.$params,i.update=r.$expr}},cr.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},cr.addBinding=function(e,n){this.bindings||t.error("Nested signals do not support binding: "+t.stringValue(e)),this.bindings.push(t.extend({signal:e},n))},cr.addScaleProj=function(e,n){this.scales.hasOwnProperty(e)&&t.error("Duplicate scale or projection name: "+t.stringValue(e)),this.scales[e]=this.add(n)},cr.addScale=function(e,t){this.addScaleProj(e,La(t))},cr.addProjection=function(e,t){this.addScaleProj(e,Ma(t))},cr.getScale=function(e){return this.scales[e]||t.error("Unrecognized scale name: "+t.stringValue(e)),this.scales[e]},cr.projectionRef=cr.scaleRef=function(e){return Re(this.getScale(e))},cr.projectionType=cr.scaleType=function(e){return this.getScale(e).params.type},cr.addData=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.data[e]=n},cr.getData=function(e){return this.data[e]||t.error("Undefined data set name: "+t.stringValue(e)),this.data[e]},cr.addDataPipeline=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.addData(e,Te.fromEntries(this,n))};var fr=function(e){var n,a=xt();for(n in e)a[n]=t.isObject(a[n])?t.extend(a[n],e[n]):a[n]=e[n];return a},pr=30,gr=2,hr="#4c78a8",mr="#000",vr="#888",yr="#ddd",xr=function(e,t){return mt(e,new vt(fr(t||e.config))).toRuntime()};e.parse=xr,e.signal=wt,e.signalUpdates=fn,e.stream=un,e.codeGenerator=an,e.functionContext=Kt,e.expressionFunction=ee,e.MarkRole=Pn,e.FrameRole=$n,e.ScopeRole=_n,e.AxisRole=En,e.AxisDomainRole=On,e.AxisGridRole=Dn,e.AxisLabelRole=Fn,e.AxisTickRole=Vn,e.AxisTitleRole=jn,e.LegendRole=Mn,e.LegendEntryRole=An,e.LegendLabelRole=Wn,e.LegendSymbolRole=Ln,e.LegendTitleRole=qn,e.Scope=vt,e.DataScope=Te,e.formatLocale=i.formatDefaultLocale,e.timeFormatLocale=o.timeFormatDefaultLocale,Object.defineProperty(e,"__esModule",{value:!0})});