!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.vega=e.vega||{})}(this,function(e){"use strict";function t(e){return c.hasOwnProperty(e)}function r(e,t,r,n,i){for(var o,s=0,f=e.length;t<f;++t){if(o=e[t],!s&&o===r)return t;i&&i.indexOf(o)>=0?--s:n&&n.indexOf(o)>=0&&++s}return t}function n(e){for(var t=[],n=0,i=e.length,o=0;o<i;)o=r(e,o,b,h+m,p+g),t.push(e.substring(n,o).trim()),n=++o;if(0===t.length)throw"Empty event selector: "+e;return t}function i(e){return"["===e[0]?o(e):s(e)}function o(e){var t,o,s=e.length,f=1;if((f=r(e,f,p,h,p))===s)throw"Empty between selector: "+e;if(t=n(e.substring(1,f)),2!==t.length)throw"Between selector must have two elements: "+e;if(e=e.slice(f+1).trim(),e[0]!==v)throw"Expected '>' after between selector: "+e;return t=t.map(i),o=i(e.slice(1).trim()),o.between?{between:t,stream:o}:(o.between=t,o)}function s(e){var n,i,o={source:u},s=[],c=[0,0],l=0,a=0,b=e.length,v=0;if(e[b-1]===g){if(!((v=e.lastIndexOf(m))>=0))throw"Unmatched right brace: "+e;try{c=f(e.substring(v+1,b-1))}catch(t){throw"Invalid throttle specification: "+e}e=e.slice(0,v).trim(),b=e.length,v=0}if(!b)throw e;if(e[0]===d&&(l=++v),n=r(e,v,w),n<b&&(s.push(e.substring(a,n).trim()),a=v=++n),(v=r(e,v,h))===b)s.push(e.substring(a,b).trim());else if(s.push(e.substring(a,v).trim()),i=[],(a=++v)===b)throw"Unmatched left bracket: "+e;for(;v<b;){if((v=r(e,v,p))===b)throw"Unmatched left bracket: "+e;if(i.push(e.substring(a,v).trim()),v<b-1&&e[++v]!==h)throw"Expected left bracket: "+e;a=++v}if(!(b=s.length)||y.test(s[b-1]))throw"Invalid event selector: "+e;return b>1?(o.type=s[1],l?o.markname=s[0].slice(1):t(s[0])?o.marktype=s[0]:o.source=s[0]):o.type=s[0],"!"===o.type.slice(-1)&&(o.consume=!0,o.type=o.type.slice(0,-1)),null!=i&&(o.filter=i),c[0]&&(o.throttle=c[0]),c[1]&&(o.debounce=c[1]),o}function f(e){var t=e.split(b);if(!e.length||t.length>2)throw e;return t.map(function(t){var r=+t;if(r!==r)throw e;return r})}var u,c,l=function(e,t,r){return u=t||a,c=r||x,n(e.trim()).map(i)},a="view",h="[",p="]",m="{",g="}",w=":",b=",",d="@",v=">",y=/[\[\]\{\}]/,x={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};e.selector=l,Object.defineProperty(e,"__esModule",{value:!0})});